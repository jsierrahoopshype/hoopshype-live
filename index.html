<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=1920">
<title>HoopsHype TV — Live Broadcast</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800;900&family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --canvas-w:1920px;--canvas-h:1080px;
  --bg-base:#0A0E14;--bg-panel:#111820;--bg-panel-alt:#161E28;--bg-surface:#1A2332;
  --bg-row-odd:rgba(255,255,255,0.025);--border-subtle:rgba(255,255,255,0.06);
  --border-medium:rgba(255,255,255,0.10);--border-accent:rgba(255,140,0,0.3);
  --text-primary:#F0F2F5;--text-secondary:#8B95A5;--text-tertiary:#5A6577;--text-muted:#3D4756;
  --accent:#FF8C00;--accent-bright:#FFa726;--accent-glow:rgba(255,140,0,0.15);
  --live-red:#EF4444;--live-glow:rgba(239,68,68,0.3);--win-green:#22C55E;--new-badge:#3B82F6;
  --font-display:'Outfit',sans-serif;--font-body:'DM Sans',sans-serif;--font-mono:'DM Mono',monospace;
  --sp-1:4px;--sp-2:8px;--sp-3:12px;--sp-4:16px;--sp-5:20px;--sp-6:24px;--sp-8:32px;--sp-10:40px;
  --radius-sm:6px;--radius-md:10px;--radius-lg:14px;
  --topbar-h:48px;--ticker-h:48px;--sidebar-w:380px;--safe-margin:20px;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html,body{width:var(--canvas-w);height:var(--canvas-h);overflow:hidden;background:var(--bg-base);color:var(--text-primary);font-family:var(--font-body);font-size:15px;line-height:1.4;-webkit-font-smoothing:antialiased}

.broadcast-canvas{width:var(--canvas-w);height:var(--canvas-h);display:grid;grid-template-rows:var(--topbar-h) 1fr var(--ticker-h);grid-template-columns:1fr var(--sidebar-w);grid-template-areas:"topbar topbar" "main sidebar" "ticker ticker";padding:0 var(--safe-margin)}

/* ═══ TOPBAR ═══ */
.topbar{grid-area:topbar;display:flex;align-items:center;justify-content:space-between;padding:0 var(--sp-5);background:linear-gradient(180deg,rgba(10,14,20,0.95),rgba(10,14,20,0.80));border-bottom:1px solid var(--border-subtle);z-index:100}
.topbar-left{display:flex;align-items:center;gap:var(--sp-4)}
.logo-img{height:36px;width:auto;display:block}
.live-badge{display:flex;align-items:center;gap:6px;padding:4px 12px 4px 10px;background:rgba(239,68,68,0.12);border:1px solid rgba(239,68,68,0.25);border-radius:20px;font-family:var(--font-display);font-weight:700;font-size:11px;letter-spacing:1.2px;text-transform:uppercase;color:var(--live-red)}
.live-dot{width:8px;height:8px;background:var(--live-red);border-radius:50%;animation:livePulse 1.5s ease-in-out infinite}
@keyframes livePulse{0%,100%{opacity:1;box-shadow:0 0 0 0 var(--live-glow)}50%{opacity:0.6;box-shadow:0 0 0 6px transparent}}
.topbar-right{display:flex;align-items:center;gap:var(--sp-6)}
.topbar-clock{font-family:var(--font-mono);font-size:14px;font-weight:500;color:var(--text-secondary)}
.topbar-date{font-family:var(--font-body);font-size:13px;color:var(--text-tertiary)}
.topbar-tz{font-family:var(--font-mono);font-size:10px;color:var(--text-muted);margin-left:-12px}

/* ═══ MAIN AREA ═══ */
.main-area{grid-area:main;padding:var(--sp-4) var(--sp-4) var(--sp-3) var(--sp-3);overflow:hidden;display:flex;flex-direction:column;gap:var(--sp-3)}
.featured-game{flex:1;background:var(--bg-panel);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);position:relative;overflow:hidden}
.featured-game::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--accent),var(--accent-bright),var(--accent));opacity:0.8;z-index:2}
.featured-game.hidden{display:none}
.game-screens{position:relative;width:100%;height:100%}
.game-screen{position:absolute;inset:0;padding:var(--sp-4) var(--sp-5);display:flex;flex-direction:column;opacity:0;transform:translateX(30px);transition:opacity 0.45s ease,transform 0.45s ease;pointer-events:none}
.game-screen.active{opacity:1;transform:translateX(0);pointer-events:auto}
.game-screen.exit-left{opacity:0;transform:translateX(-30px)}
.screen-dots{position:absolute;bottom:var(--sp-2);left:50%;transform:translateX(-50%);display:flex;gap:6px;z-index:5}
.screen-dot{width:6px;height:6px;border-radius:50%;background:var(--text-muted);transition:background 0.3s,width 0.3s}
.screen-dot.active{background:var(--accent);width:18px;border-radius:3px}

/* ─── SCREEN 1: BIG SCOREBOARD ─── */
.s1-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--sp-2)}
.s1-label{font-family:var(--font-display);font-weight:600;font-size:12px;letter-spacing:1.5px;text-transform:uppercase;color:var(--accent)}
.s1-period-row{display:flex;align-items:center;gap:var(--sp-3)}
.s1-period-badge{font-family:var(--font-display);font-weight:700;font-size:14px;padding:4px 14px;background:var(--bg-surface);border-radius:var(--radius-sm);color:var(--text-primary)}
.s1-clock{font-family:var(--font-mono);font-weight:600;font-size:18px;color:var(--live-red)}
.s1-venue{font-family:var(--font-body);font-size:11px;color:var(--text-muted)}

/* Big scoreboard block */
.s1-scoreboard{display:flex;align-items:stretch;gap:0;flex:0 0 auto;background:var(--bg-surface);border-radius:var(--radius-md);overflow:hidden;margin-bottom:var(--sp-3)}
.s1-team-side{flex:1;display:flex;align-items:center;padding:var(--sp-4) var(--sp-5);gap:var(--sp-4)}
.s1-team-side.home{justify-content:flex-end;text-align:right}
.s1-team-logo{width:72px;height:72px;background:var(--bg-panel);border:2px solid var(--border-medium);border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-weight:800;font-size:22px;color:var(--text-secondary);flex-shrink:0}
.s1-team-logo img,.bs-team-logo img{width:85%;height:85%;object-fit:contain}
.s1-team-info{display:flex;flex-direction:column;gap:2px}
.s1-team-city{font-family:var(--font-display);font-weight:500;font-size:11px;letter-spacing:1px;text-transform:uppercase;color:var(--text-tertiary)}
.s1-team-name{font-family:var(--font-display);font-weight:800;font-size:26px;letter-spacing:-0.5px;line-height:1.1}
.s1-team-record{font-family:var(--font-mono);font-size:12px;color:var(--text-tertiary)}
.s1-score-center{flex:0 0 320px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--bg-panel);position:relative}
.s1-scores-row{display:flex;align-items:baseline;gap:var(--sp-6)}
.s1-big-score{font-family:var(--font-display);font-weight:900;font-size:80px;letter-spacing:-3px;line-height:1;text-shadow:0 2px 24px rgba(0,0,0,0.6)}
.s1-big-score.leading{color:var(--accent-bright)}
.s1-score-sep{font-family:var(--font-display);font-weight:200;font-size:50px;color:var(--text-muted)}

/* Quarter scores */
.s1-quarters{display:flex;gap:0;margin-top:var(--sp-2);width:100%}
.s1-q-col{display:flex;flex-direction:column;align-items:center;flex:1}
.s1-q-header{font-family:var(--font-display);font-weight:600;font-size:9px;letter-spacing:1px;text-transform:uppercase;color:var(--text-muted);padding:2px 0;border-bottom:1px solid var(--border-subtle);width:100%;text-align:center}
.s1-q-val{font-family:var(--font-mono);font-weight:500;font-size:13px;padding:3px 0;color:var(--text-secondary);width:100%;text-align:center}
.s1-q-val.current{color:var(--accent-bright);font-weight:700}
.s1-q-val.highlight,.bs-q-val.highlight{color:var(--accent-bright);font-weight:700}
.s1-q-val:first-of-type{border-bottom:1px solid rgba(255,255,255,0.03)}

/* Stats + Leaders below scoreboard */
.s1-bottom{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr auto;gap:var(--sp-3);flex:1;min-height:0}
.s1-stats-panel{background:var(--bg-surface);border-radius:var(--radius-md);padding:var(--sp-4);display:flex;flex-direction:column}
.s1-panel-title{font-family:var(--font-display);font-weight:700;font-size:11px;letter-spacing:1.5px;text-transform:uppercase;color:var(--accent);margin-bottom:var(--sp-3)}
.stat-center-row{display:flex;justify-content:center;align-items:center;gap:var(--sp-4);padding:4px 0;border-top:1px solid rgba(255,255,255,0.06)}
.scv-center-val{font-family:var(--font-mono);font-weight:600;font-size:14px;color:var(--accent-bright)}
.scv-center-label{font-family:var(--font-display);font-weight:600;font-size:10px;letter-spacing:1.2px;text-transform:uppercase;color:var(--text-tertiary)}
.s1-flow-panel{grid-column:1/-1;background:var(--bg-surface);border-radius:var(--radius-md);padding:var(--sp-3) var(--sp-4)}
.score-flow-svg{width:100%;height:auto;display:block}
.flow-legend{display:flex;gap:var(--sp-5);justify-content:center;margin-top:var(--sp-1)}
.flow-legend-item{display:flex;align-items:center;gap:var(--sp-1);font-family:var(--font-display);font-size:10px;font-weight:600;color:var(--text-secondary)}
.flow-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.stat-compare-row{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;padding:3px 0}
.stat-compare-row+.stat-compare-row{border-top:1px solid rgba(255,255,255,0.03)}
.scv-left,.scv-right{font-family:var(--font-mono);font-weight:500;font-size:14px;color:var(--text-secondary)}
.scv-left{text-align:right;padding-right:var(--sp-3)}
.scv-right{text-align:left;padding-left:var(--sp-3)}
.scv-left.better,.scv-right.better{color:var(--accent-bright);font-weight:700}
.scv-label{font-family:var(--font-display);font-weight:600;font-size:10px;letter-spacing:1.2px;text-transform:uppercase;color:var(--text-tertiary);text-align:center;min-width:48px}
.leader-row{display:flex;justify-content:space-between;align-items:center;padding:3px var(--sp-2);border-radius:var(--radius-sm)}
.leader-row+.leader-row{border-top:1px solid rgba(255,255,255,0.03)}
.leader-stat-type{font-family:var(--font-display);font-weight:700;font-size:10px;letter-spacing:1px;text-transform:uppercase;color:var(--accent);width:32px}
.leader-player{font-family:var(--font-body);font-size:13px;color:var(--text-secondary);flex:1;margin-left:var(--sp-2)}
.leader-value{font-family:var(--font-mono);font-weight:600;font-size:14px;color:var(--text-primary)}
.leaders-team-name{font-family:var(--font-display);font-weight:600;font-size:10px;letter-spacing:1.5px;text-transform:uppercase;color:var(--text-tertiary);margin-bottom:var(--sp-1);margin-top:var(--sp-2)}
.leaders-team-name:first-child{margin-top:0}
.leaders-grid{display:grid;grid-template-columns:1fr 1fr;gap:0 var(--sp-3)}

/* ─── SCREENS 2 & 3: BOXSCORE W/ SCOREBOARD ─── */
.bs-scoreboard{display:flex;align-items:stretch;background:var(--bg-surface);border-radius:var(--radius-md);overflow:hidden;margin-bottom:var(--sp-3);flex-shrink:0}
.bs-team-side{flex:1;display:flex;align-items:center;padding:var(--sp-3) var(--sp-4);gap:var(--sp-3)}
.bs-team-side.home{justify-content:flex-end;text-align:right}
.bs-team-logo{width:52px;height:52px;background:var(--bg-panel);border:2px solid var(--border-medium);border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-weight:800;font-size:16px;color:var(--text-secondary);flex-shrink:0}
.bs-team-name{font-family:var(--font-display);font-weight:800;font-size:20px;letter-spacing:-0.3px}
.bs-team-record{font-family:var(--font-mono);font-size:11px;color:var(--text-tertiary)}
.bs-score-center{flex:0 0 280px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--bg-panel)}
.bs-scores-row{display:flex;align-items:baseline;gap:var(--sp-5)}
.bs-big-score{font-family:var(--font-display);font-weight:900;font-size:52px;letter-spacing:-2px;line-height:1;text-shadow:0 2px 16px rgba(0,0,0,0.5)}
.bs-big-score.leading{color:var(--accent-bright)}
.bs-score-sep{font-family:var(--font-display);font-weight:200;font-size:32px;color:var(--text-muted)}
.bs-quarters{display:flex;gap:0;margin-top:var(--sp-1);width:100%}
.bs-q-col{display:flex;flex-direction:column;align-items:center;flex:1}
.bs-q-header{font-family:var(--font-display);font-weight:600;font-size:8px;letter-spacing:1px;text-transform:uppercase;color:var(--text-muted);padding:1px 0;border-bottom:1px solid var(--border-subtle);width:100%;text-align:center}
.bs-q-val{font-family:var(--font-mono);font-weight:500;font-size:12px;padding:2px 0;color:var(--text-secondary);width:100%;text-align:center}
.bs-q-val.current{color:var(--accent-bright);font-weight:700}
.bs-q-val:first-of-type{border-bottom:1px solid rgba(255,255,255,0.03)}
.bs-period-clock{font-family:var(--font-mono);font-size:11px;color:var(--live-red);margin-top:2px}

/* Tab row for team selector */
.bs-tabs{display:flex;margin-bottom:var(--sp-2);gap:0;background:var(--bg-surface);border-radius:var(--radius-sm);overflow:hidden}
.bs-tab{flex:1;padding:var(--sp-2) var(--sp-4);font-family:var(--font-display);font-weight:700;font-size:12px;letter-spacing:0.5px;text-align:center;color:var(--text-tertiary);display:flex;align-items:center;justify-content:center;gap:var(--sp-2);border-bottom:2px solid transparent}
.bs-tab.active{color:var(--text-primary);background:rgba(255,255,255,0.03);border-bottom-color:var(--accent)}
.bs-tab-dot{width:6px;height:6px;border-radius:50%;background:var(--win-green)}

/* Box score table */
.bs-table-wrap{flex:1;overflow:hidden}
.bs-table{width:100%;border-collapse:collapse;table-layout:fixed}
.bs-table th{font-family:var(--font-display);font-weight:600;font-size:10px;letter-spacing:1px;text-transform:uppercase;color:var(--text-tertiary);text-align:center;padding:var(--sp-2);border-bottom:1px solid var(--border-medium);background:var(--bg-panel)}
.bs-table th:first-child{text-align:left;width:200px}
.bs-table td{font-family:var(--font-mono);font-size:12.5px;text-align:center;padding:4px var(--sp-2);color:var(--text-secondary);border-bottom:1px solid rgba(255,255,255,0.02)}
.bs-table tbody tr:nth-child(odd){background:var(--bg-row-odd)}
.bs-table td:first-child{text-align:left;font-family:var(--font-body);font-weight:500;color:var(--text-primary);font-size:13px;white-space:nowrap}
.bs-table td.highlight{color:var(--accent-bright);font-weight:700}
.player-pos{font-family:var(--font-display);font-size:9px;font-weight:600;color:var(--text-muted);margin-left:5px}
.player-num{font-family:var(--font-mono);font-size:9px;color:var(--text-muted);margin-left:5px}
.section-label{font-family:var(--font-display);font-weight:700;font-size:10px;letter-spacing:1.5px;text-transform:uppercase;color:var(--accent);padding:var(--sp-2);border-bottom:1px solid var(--border-subtle)}
.section-label td{font-family:var(--font-display);font-weight:700;font-size:10px;letter-spacing:1.5px;text-transform:uppercase;color:var(--accent);text-align:left}
.bs-table tfoot td{font-weight:700;color:var(--text-primary);border-top:1px solid var(--border-medium);background:rgba(255,140,0,0.04);font-size:13px}
.bs-table tfoot .pct{font-size:10px;color:var(--accent);font-weight:600;display:block;margin-top:1px}

/* Mini scores */
.mini-scores{padding:var(--sp-2) 0;overflow:hidden;flex-shrink:0;position:relative}
.mini-scores.hidden{display:none}
.mini-scores-track{display:flex;gap:var(--sp-3);transition:transform 0.5s ease}
.mini-game{flex:0 0 auto;display:flex;align-items:center;gap:var(--sp-3);padding:var(--sp-2) var(--sp-4);background:var(--bg-panel);border:1px solid var(--border-subtle);border-radius:var(--radius-md);min-width:190px;transition:border-color 0.3s,background 0.3s}
.mini-game.active{border-color:var(--accent);background:var(--bg-panel-alt)}
.mini-teams{display:flex;flex-direction:column;gap:2px}
.mini-team-row{display:flex;align-items:center;gap:var(--sp-2)}
.mini-team-abbr{font-family:var(--font-display);font-weight:700;font-size:12px;width:36px;color:var(--text-secondary)}
.mini-score{font-family:var(--font-mono);font-weight:500;font-size:14px;min-width:28px;text-align:right}
.mini-score.leading{color:var(--accent-bright);font-weight:700}
.mini-leaders{display:flex;flex-direction:column;gap:0;padding:2px 8px 0;border-top:1px solid rgba(200,165,80,0.06)}
.mini-ldr{font-family:var(--font-mono);font-size:9px;color:var(--text-tertiary);white-space:nowrap;line-height:1.3}
.mini-period{font-family:var(--font-mono);font-size:10px;color:var(--live-red);text-align:center;min-width:36px}
.mini-period.final{color:var(--text-tertiary)}
.mini-team-logo{width:20px;height:20px;object-fit:contain;flex-shrink:0}

/* ═══ RANKINGS ═══ */
.rankings-mode{flex:1;display:none;flex-direction:column;gap:var(--sp-3)}
.rankings-mode.active{display:flex}
.section-nav{display:flex;gap:var(--sp-2);padding:0 var(--sp-3);align-items:center;flex-wrap:wrap}
.section-btn{font-family:var(--font-display);font-size:11px;font-weight:600;letter-spacing:0.5px;padding:4px 10px;border:1px solid var(--border-medium);border-radius:var(--radius-sm);background:var(--bg-surface);color:var(--text-tertiary);cursor:pointer;transition:all 0.15s}
.section-btn:hover{border-color:var(--accent);color:var(--text-primary)}
.section-btn.active{background:var(--accent);border-color:var(--accent);color:var(--bg-base)}
.section-nav-hint{font-family:var(--font-mono);font-size:10px;color:var(--text-muted);margin-left:auto}
.next-games-bar{background:var(--bg-panel);border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:var(--sp-3) var(--sp-5);display:flex;align-items:center;gap:var(--sp-6);flex-shrink:0}
.next-games-label{font-family:var(--font-display);font-weight:600;font-size:11px;letter-spacing:1.5px;text-transform:uppercase;color:var(--accent);white-space:nowrap}
.next-games-list{display:flex;gap:var(--sp-4);overflow:hidden;flex:1;position:relative}
.next-games-page{display:flex;gap:var(--sp-4);position:absolute;left:0;top:0;width:100%;opacity:0;transform:translateY(8px);transition:opacity 0.4s ease,transform 0.4s ease;pointer-events:none}
.next-games-page.active{position:relative;opacity:1;transform:translateY(0);pointer-events:auto}
.next-game-item{display:flex;align-items:center;gap:var(--sp-2);padding:var(--sp-1) var(--sp-3);background:var(--bg-surface);border-radius:var(--radius-sm);white-space:nowrap;font-size:13px}
.next-game-teams{font-family:var(--font-display);font-weight:600}
.next-game-time{font-family:var(--font-mono);font-size:12px;color:var(--text-tertiary)}
.rankings-panel{flex:1;background:var(--bg-panel);border:1px solid var(--border-subtle);border-radius:var(--radius-lg);padding:var(--sp-6);position:relative;overflow:hidden;animation:fadeSlideIn 0.5s ease-out;display:flex;flex-direction:column}
.rankings-panel::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--accent),transparent);opacity:0.6}
@keyframes fadeSlideIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.rankings-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:var(--sp-5)}
.rankings-title{font-family:var(--font-display);font-weight:800;font-size:20px}
.rankings-source{font-family:var(--font-mono);font-size:11px;color:var(--text-tertiary)}
.rankings-progress{display:flex;gap:4px}
.rankings-progress-dot{width:6px;height:6px;border-radius:50%;background:var(--text-muted);transition:background 0.3s,width 0.3s}
.rankings-progress-dot.active{background:var(--accent);width:18px;border-radius:3px}
.rankings-next{position:absolute;bottom:8px;left:0;right:0;text-align:center;padding:6px 0}
.rankings-next-label{font-family:var(--font-heading);font-size:12px;color:var(--accent);letter-spacing:3px;font-weight:700}
.rankings-next-title{font-family:var(--font-body);font-size:13px;color:var(--text-secondary)}
.rankings-table{width:100%;border-collapse:collapse}
.rankings-table th{font-family:var(--font-display);font-weight:600;font-size:10px;letter-spacing:1.5px;text-transform:uppercase;color:var(--text-tertiary);text-align:left;padding:var(--sp-2) var(--sp-3);border-bottom:1px solid var(--border-subtle)}
.rankings-table th:first-child{width:40px;text-align:center}
.rankings-table td{padding:var(--sp-2) var(--sp-3);font-size:14px;border-bottom:1px solid rgba(255,255,255,0.02)}
.rankings-table tbody tr:nth-child(odd){background:var(--bg-row-odd)}
.rank-num{font-family:var(--font-display);font-weight:800;font-size:16px;color:var(--accent);text-align:center;display:block}
.rank-num.top-3{color:var(--accent-bright)}
.rank-player{font-family:var(--font-display);font-weight:600}
.rank-team{font-family:var(--font-body);font-size:12px;color:var(--text-tertiary);margin-left:var(--sp-2)}
.rank-value{font-family:var(--font-mono);font-weight:500}
/* Salary table styles */
.sal-table-wrap{flex:1;overflow-y:auto;overflow-x:hidden;scrollbar-width:none;-ms-overflow-style:none}
.sal-table-wrap::-webkit-scrollbar{display:none}
.sal-table{width:100%;border-collapse:collapse;table-layout:fixed}
.sal-th-player{width:210px}
.sal-th-salary{width:140px}
.sal-th-bar{width:auto}
.sal-th-status{width:120px}
.sal-table thead th{font-family:var(--font-display);font-weight:600;font-size:10px;letter-spacing:1px;text-transform:uppercase;color:var(--text-tertiary);text-align:left;padding:var(--sp-2) var(--sp-3);border-bottom:1px solid var(--border-medium);background:var(--bg-panel)}
.sal-table tbody tr{border-bottom:1px solid rgba(255,255,255,0.02)}
.sal-table tbody tr:nth-child(odd){background:var(--bg-row-odd)}
.sal-player{font-family:var(--font-body);font-weight:500;font-size:13px;color:var(--text-primary);padding:3px var(--sp-3);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.sal-flag{vertical-align:middle;margin-left:5px;display:inline-block;border-radius:1px}
.sal-salary-stack{padding:2px var(--sp-3);white-space:nowrap}
.sal-current{font-family:var(--font-mono);font-weight:600;font-size:13px;color:var(--accent-bright);line-height:1.3}
.sal-next-yr{font-family:var(--font-mono);font-weight:400;font-size:11px;color:var(--text-tertiary);line-height:1.3}
.sal-bar-cell{padding:3px var(--sp-2)}
.sal-bar{height:14px;background:linear-gradient(90deg,rgba(255,140,0,0.5),rgba(255,140,0,0.2));border-radius:2px;min-width:2%}
.sal-status{font-family:var(--font-body);font-size:11px;color:var(--text-secondary);text-align:right;padding:3px var(--sp-3);white-space:nowrap}
/* Rating table styles */
.hist-th-team{width:105px;text-align:left}
.hist-team{font-family:var(--font-body);font-size:12px;color:var(--text-secondary);padding:3px var(--sp-2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:105px}
.sal-salary{font-family:var(--font-mono);font-weight:600;font-size:13px;color:var(--accent-bright);padding:3px var(--sp-3);white-space:nowrap;text-align:right}
.rat-th-rank{width:36px;text-align:center}
.rat-th-player{width:260px}
.rat-th-rat{width:60px}
.rat-th-bar{width:auto}
.rat-th-stat{width:60px;text-align:right}
.rat-th-g{width:35px;text-align:right}
.rat-rank{text-align:center;padding:3px var(--sp-2)}
.rat-val{font-family:var(--font-mono);font-weight:700;font-size:14px;color:var(--accent-bright);padding:3px var(--sp-3);white-space:nowrap}
.rat-stat{font-family:var(--font-mono);font-weight:500;font-size:13px;color:var(--text-secondary);text-align:right;padding:3px var(--sp-3);white-space:nowrap}
.rat-diff-up{color:#4ade80}
.rat-diff-down{color:#f87171}
/* Injury report styles */
.inj-two-col{display:flex;gap:var(--sp-4);flex:1;overflow-y:auto;scrollbar-width:none;-ms-overflow-style:none}
.inj-two-col::-webkit-scrollbar{display:none}
.inj-two-col .inj-table{flex:1;min-width:0}
.inj-table{width:100%;border-collapse:collapse}
.inj-table thead th{font-family:var(--font-display);font-weight:600;font-size:10px;letter-spacing:1px;text-transform:uppercase;color:var(--text-tertiary);text-align:left;padding:var(--sp-2) var(--sp-3);border-bottom:1px solid var(--border-medium)}
.inj-table tbody tr{border-bottom:1px solid rgba(255,255,255,0.02);height:28px}
.inj-table tbody tr:nth-child(odd){background:var(--bg-row-odd)}
.inj-th-player{width:160px}
.inj-th-status{width:100px}
.inj-th-detail{}
.inj-th-date{width:60px;text-align:right}
.inj-team-header td{font-family:var(--font-display);font-weight:700;font-size:13px;color:var(--text-primary);padding:4px var(--sp-3) 2px;border-bottom:1px solid var(--border-medium);letter-spacing:0.5px;text-transform:uppercase}
.inj-status{font-family:var(--font-display);font-weight:600;font-size:11px;padding:2px var(--sp-3);white-space:nowrap;text-transform:uppercase;letter-spacing:0.5px}
.inj-out{color:#f87171}
.inj-doubtful{color:#fb923c}
.inj-quest{color:#fbbf24}
.inj-prob{color:#4ade80}
.inj-avail{color:var(--text-tertiary)}
.inj-detail{font-family:var(--font-body);font-size:11px;color:var(--text-secondary);padding:2px var(--sp-3)}
.inj-date{font-family:var(--font-mono);font-size:10px;color:var(--text-tertiary);padding:2px var(--sp-3);white-space:nowrap;text-align:right}
/* Depth chart styles */
.dep-table{width:100%;border-collapse:collapse;table-layout:fixed}
.dep-th-level{width:90px;font-family:var(--font-display);font-weight:600;font-size:10px;letter-spacing:1px;text-transform:uppercase;color:var(--text-tertiary);text-align:left;padding:var(--sp-2) var(--sp-3);border-bottom:1px solid var(--border-medium)}
.dep-th-pos{font-family:var(--font-display);font-weight:700;font-size:13px;color:var(--accent);text-align:center;padding:var(--sp-2) var(--sp-2);border-bottom:1px solid var(--border-medium)}
.dep-level{font-family:var(--font-display);font-weight:600;font-size:11px;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:0.5px;padding:8px var(--sp-3) 8px var(--sp-4);vertical-align:top;border-right:1px solid var(--border-subtle)}
.dep-cell{text-align:center;padding:6px var(--sp-2);vertical-align:top;border-bottom:1px solid rgba(255,255,255,0.03)}
.dep-cell.dep-empty{color:var(--text-muted)}
.dep-key{font-family:var(--font-body);font-size:13px;color:var(--text-secondary);padding:10px var(--sp-4) 6px;text-align:left}
.tx-table{width:100%;border-collapse:collapse}
.tx-table th{font-family:var(--font-display);font-weight:600;font-size:11px;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:0.5px;padding:6px var(--sp-2);text-align:left;border-bottom:1px solid var(--border-subtle)}
.tx-table td{padding:5px var(--sp-2);border-bottom:1px solid rgba(255,255,255,0.04);font-family:var(--font-body);font-size:13px}
.tx-date{color:var(--text-tertiary);white-space:nowrap;width:65px}
.tx-team{color:var(--accent);font-weight:600;white-space:nowrap}
.tx-player{color:var(--text-primary);font-weight:500}
.tx-notes{color:var(--text-secondary);font-size:12px}
.tx-salary{color:var(--text-secondary);font-family:var(--font-mono);font-size:12px;text-align:right;white-space:nowrap}
.val-salary{font-family:var(--font-mono);font-size:13px;color:var(--text-secondary);padding:3px 8px;white-space:nowrap;text-align:right;width:70px}
.val-num{font-family:var(--font-mono);font-size:13px;font-weight:600;padding:3px 8px;white-space:nowrap;text-align:right;width:45px}
.val-th-sal{width:70px;text-align:right}
.val-th-val{width:45px;text-align:right}
/* Game Previews */
.prev-table{width:100%;border-collapse:collapse}
.prev-th-name{font-family:var(--font-heading);font-size:14px;color:var(--accent);text-align:left;padding:4px 8px;width:22%}
.prev-th-name-r{text-align:right}
.prev-th-stat{font-family:var(--font-mono);font-size:10px;color:var(--text-tertiary);text-align:center;padding:4px 2px;width:5%}
.prev-th-pos{font-family:var(--font-body);font-size:10px;color:var(--text-muted);text-align:center;padding:4px 2px;width:4%}
.prev-row{border-bottom:1px solid rgba(200,165,80,0.04)}
.prev-row:hover{background:rgba(200,165,80,0.03)}
.prev-name{font-family:var(--font-body);font-size:13px;color:var(--text-primary);padding:6px 8px;white-space:nowrap}
.prev-name-l{text-align:left}
.prev-name-r{text-align:right}
.prev-stat{font-family:var(--font-mono);font-size:13px;color:var(--text-tertiary);text-align:center;padding:6px 2px}
.prev-stat.prev-win{color:var(--accent);font-weight:700}
.prev-pos{font-family:var(--font-body);font-size:11px;color:var(--text-muted);text-align:center;padding:6px 2px;letter-spacing:1px}
.prev-agg{border-top:2px solid rgba(200,165,80,0.15)}
.prev-agg-label{font-family:var(--font-heading);font-size:11px;color:var(--text-tertiary);letter-spacing:1px}
.prev-agg-val{font-weight:700;font-size:14px}
.prev-logo{height:20px;width:20px;vertical-align:middle;margin:0 4px}
.prev-inj-row{border-top:1px solid rgba(200,165,80,0.08)}
.prev-inj-cell{font-family:var(--font-body);font-size:11px;color:var(--text-tertiary);padding:6px 8px}
.prev-inj-l{text-align:left}
.prev-inj-r{text-align:right}
/* Comparison cards */
.comp-card{padding:0 var(--sp-4) var(--sp-4);display:flex;flex-direction:column;height:calc(100% - 56px)}
.comp-header{display:flex;align-items:flex-start;justify-content:space-between;padding:8px 0 12px}
.comp-player{flex:1}
.comp-player-l{text-align:right;padding-right:20px}
.comp-player-r{text-align:left;padding-left:20px}
.comp-name{font-family:var(--font-heading);font-size:26px;color:var(--text-primary);line-height:1.15;white-space:nowrap}
.comp-team{font-family:var(--font-body);font-size:14px;color:var(--text-tertiary);margin-top:3px;letter-spacing:0.3px}
.comp-vs-badge{font-family:var(--font-heading);font-size:11px;color:var(--accent);letter-spacing:3px;flex-shrink:0}
.comp-score-col{display:flex;flex-direction:column;align-items:center;padding:0 4px;flex-shrink:0}
.comp-overall{display:flex;align-items:center;gap:4px}
.comp-overall-num{font-family:var(--font-mono);font-size:22px;color:var(--text-tertiary);font-weight:700}
.comp-overall-num.comp-win{color:var(--accent)}
.comp-overall-vs{font-family:var(--font-mono);font-size:14px;color:var(--text-muted)}
.comp-sec-score{font-family:var(--font-mono);font-size:10px;color:var(--text-tertiary);font-weight:600}
.comp-sec-win-a .comp-sec-score:first-child{color:var(--accent)}
.comp-sec-win-b .comp-sec-score:last-child{color:var(--accent)}
.comp-body{flex:1;overflow-y:auto}
.comp-sec{margin-bottom:2px}
.comp-sec-hd{font-family:var(--font-body);font-size:11px;color:var(--accent);letter-spacing:2px;text-align:center;padding:5px 0 2px;opacity:0.7}
.comp-row{display:flex;align-items:center;height:22px;padding:0 2px}
.comp-val{font-family:var(--font-mono);font-size:15px;color:var(--text-tertiary);width:58px;flex-shrink:0}
.comp-val-l{text-align:right}
.comp-val-r{text-align:left}
.comp-val.comp-win{color:var(--accent);font-weight:700}
.comp-bars{flex:1;display:flex;align-items:center;margin:0 4px;height:14px}
.comp-bar-l{flex:1;display:flex;justify-content:flex-end;height:100%}
.comp-bar-r{flex:1;display:flex;justify-content:flex-start;height:100%}
.comp-fill-l,.comp-fill-r{height:100%;border-radius:2px;background:rgba(200,165,80,0.1);min-width:2px;transition:width .3s}
.comp-fill-l.comp-win,.comp-fill-r.comp-win{background:var(--accent)}
.comp-fill-l{border-radius:2px 0 0 2px;margin-right:1px}
.comp-fill-r{border-radius:0 2px 2px 0;margin-left:1px}
.comp-lbl{font-family:var(--font-body);font-size:11px;color:var(--text-secondary);min-width:70px;text-align:center;letter-spacing:0.3px;padding:0 2px;flex-shrink:0}
.comp-footer{display:flex;border-top:1px solid rgba(200,165,80,0.08);padding:5px 2px 0;margin-top:3px}
.comp-foot-col{flex:1;display:flex;flex-direction:column;gap:2px}
.comp-foot-mid{align-items:center;flex:0 0 auto;padding:0 12px}
.comp-foot-right{align-items:flex-end}
.comp-foot-val{font-family:var(--font-mono);font-size:13px;color:var(--text-secondary);line-height:1.4}
.comp-foot-lbl{font-family:var(--font-body);font-size:10px;color:var(--text-tertiary);letter-spacing:1px;line-height:1.4}
.dep-row-starters{background:rgba(99,179,237,0.08)}
.dep-row-starters .dep-level{color:var(--accent-bright)}
.dep-row-starters .dep-name{color:#fff;font-weight:600}
.dep-row-bench{background:var(--bg-row-odd)}
.dep-row-out{background:rgba(248,113,113,0.06)}
.dep-row-out .dep-level{color:#f87171}
.dep-row-out .dep-name{color:var(--text-tertiary)}
.dep-name{font-family:var(--font-body);font-weight:500;font-size:13px;color:var(--text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.dep-sal{font-family:var(--font-mono);font-size:11px;color:var(--text-tertiary);margin-top:2px}
.dep-team-header td{font-family:var(--font-display);font-weight:700;font-size:14px;color:var(--text-primary);padding:10px var(--sp-3) 4px;border-bottom:1px solid var(--border-medium);letter-spacing:0.5px;text-transform:uppercase}

/* ═══ SIDEBAR ═══ */
.sidebar{grid-area:sidebar;display:flex;flex-direction:column;padding:var(--sp-4) var(--sp-3) var(--sp-3) 0;gap:var(--sp-3);overflow:hidden}
.sidebar-header{display:flex;align-items:center;padding:0 var(--sp-3) var(--sp-2);gap:var(--sp-2)}
.sidebar-title{font-family:var(--font-display);font-weight:700;font-size:12px;letter-spacing:1px;text-transform:uppercase;color:var(--text-primary);display:flex;align-items:center;gap:var(--sp-2)}
.bsky-logo{width:18px;height:18px;display:inline-flex;align-items:center;justify-content:center}
.bsky-logo svg{width:18px;height:18px}
.feed-container{flex:1;overflow:hidden;display:flex;flex-direction:column;gap:var(--sp-3);mask-image:linear-gradient(to bottom,black 0%,black 90%,transparent 100%);-webkit-mask-image:linear-gradient(to bottom,black 0%,black 90%,transparent 100%)}
.feed-post{background:var(--bg-panel);border:1px solid var(--border-subtle);border-radius:var(--radius-md);padding:var(--sp-3) var(--sp-4);animation:postSlideIn 0.4s ease-out;flex-shrink:0}
@keyframes postSlideIn{from{opacity:0;transform:translateX(10px)}to{opacity:1;transform:translateX(0)}}
.post-header{display:flex;align-items:center;gap:var(--sp-2);margin-bottom:var(--sp-2)}
.post-avatar-wrap{width:28px;height:28px;flex-shrink:0}
.post-avatar{width:28px;height:28px;border-radius:50%;background:var(--bg-surface);border:1px solid var(--border-subtle);display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-weight:700;font-size:10px;color:var(--accent);flex-shrink:0}
.post-avatar-img{width:28px;height:28px;border-radius:50%;border:1px solid var(--border-subtle);object-fit:cover;display:block}
.post-meta{flex:1;min-width:0}
.post-author{font-family:var(--font-display);font-weight:600;font-size:13px;color:var(--text-primary);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.post-handle{font-family:var(--font-mono);font-size:10px;color:var(--text-tertiary)}
.post-time{font-family:var(--font-mono);font-size:10px;color:var(--text-muted);flex-shrink:0}
.post-text{font-family:var(--font-body);font-size:13.5px;line-height:1.45;color:var(--text-primary)}
.post-images{display:flex;gap:4px;margin-top:6px;border-radius:6px;overflow:hidden}
.post-img{max-width:100%;max-height:120px;border-radius:6px;object-fit:cover;flex:1;min-width:0}
.post-quote{margin-top:6px;padding:6px 10px;border-left:2px solid var(--accent);background:rgba(200,165,80,0.04);border-radius:0 4px 4px 0}
.post-quote-author{font-family:var(--font-body);font-size:11px;font-weight:600;color:var(--text-secondary)}
.post-quote-handle{font-weight:400;color:var(--text-tertiary)}
.post-quote-text{font-family:var(--font-body);font-size:12px;color:var(--text-secondary);line-height:1.35;margin-top:2px}

/* ═══ TICKER ═══ */
.ticker-area{grid-area:ticker;display:flex;align-items:center;background:var(--bg-panel);border-top:1px solid var(--border-subtle);overflow:hidden;position:relative}
.ticker-area::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--accent),transparent);opacity:0.4}
.ticker-label{flex-shrink:0;padding:0 var(--sp-5);font-family:var(--font-display);font-weight:700;font-size:11px;letter-spacing:1.5px;text-transform:uppercase;color:var(--bg-base);background:var(--accent);height:100%;display:flex;align-items:center;position:relative;z-index:2}
.ticker-label::after{content:'';position:absolute;right:-16px;top:0;bottom:0;width:16px;background:linear-gradient(to right,var(--accent),transparent);opacity:0.3}
.ticker-track{flex:1;overflow:hidden;height:100%;display:flex;align-items:center}
.ticker-content{display:flex;align-items:center;white-space:nowrap;animation:tickerScroll var(--ticker-duration,60s) linear infinite;padding-left:20px}
@keyframes tickerScroll{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
.ticker-item{display:inline-flex;align-items:center;gap:var(--sp-2);padding:0 var(--sp-6)}
.ticker-badge{font-family:var(--font-display);font-weight:700;font-size:9px;letter-spacing:1px;text-transform:uppercase;padding:2px 8px;border-radius:3px;flex-shrink:0;background:rgba(59,130,246,0.15);color:var(--new-badge);border:1px solid rgba(59,130,246,0.25)}
.ticker-headline{font-family:var(--font-body);font-size:14px;font-weight:500;color:var(--text-primary)}
.ticker-time{font-family:var(--font-mono);font-size:10px;color:var(--text-tertiary)}
.ticker-sep{color:var(--text-muted);font-size:6px;margin:0 var(--sp-1)}
</style>
</head>
<body>
<div class="broadcast-canvas">
  <header class="topbar">
    <div class="topbar-left">
      <img class="logo-img" src="/hoopshype-logo.png" alt="HoopsHype">
      <div class="live-badge" id="liveBadge"><div class="live-dot"></div>LIVE</div>
    </div>
    <div class="topbar-right">
      <div class="topbar-date" id="dateDisplay"></div>
      <div class="topbar-clock" id="clockDisplay"></div>
      <div class="topbar-tz">ET</div>
    </div>
  </header>

  <main class="main-area" id="mainArea">
    <div class="featured-game" id="featuredGame">
      <div class="game-screens" id="gameScreens">
        <div class="game-screen active" id="screen1"></div>
        <div class="game-screen" id="screen2"></div>
        <div class="game-screen" id="screen3"></div>
      </div>
      <div class="screen-dots" id="screenDots"><div class="screen-dot active"></div><div class="screen-dot"></div><div class="screen-dot"></div></div>
    </div>
    <div class="mini-scores" id="miniScores"><div class="mini-scores-track" id="miniScoresTrack"></div></div>
    <div class="rankings-mode" id="rankingsMode">
      <div class="next-games-bar"><div class="next-games-label">▶ NEXT GAMES</div><div class="next-games-list" id="nextGamesList"></div></div>
      <div class="section-nav" id="sectionNav"><button class="section-btn active" data-section="teamRatings" onclick="jumpSection('teamRatings')">Team Ratings [T]</button><button class="section-btn" data-section="countingStats" onclick="jumpSection('countingStats')">Stats [C]</button><button class="section-btn" data-section="depth" onclick="jumpSection('depth')">Depth Charts [D]</button><button class="section-btn" data-section="injuries" onclick="jumpSection('injuries')">Injuries [I]</button><button class="section-btn" data-section="ratings" onclick="jumpSection('ratings')">Global Rating [G]</button><button class="section-btn" data-section="draftClass" onclick="jumpSection('draftClass')">Draft [Y]</button><button class="section-btn" data-section="transactions" onclick="jumpSection('transactions')">Transactions [X]</button><button class="section-btn" data-section="value" onclick="jumpSection('value')">Value [V]</button><button class="section-btn" data-section="matchups" onclick="jumpSection('matchups')">Matchups [M]</button><button class="section-btn" data-section="previews" onclick="jumpSection('previews')">Previews [P]</button><button class="section-btn" data-section="salaries" onclick="jumpSection('salaries')">Salaries [S]</button><button class="section-btn" data-section="histSalaries" onclick="jumpSection('histSalaries')">History [H]</button><span class="section-nav-hint">← → browse</span></div>
      <div class="rankings-panel" id="rankingsPanel"></div>
    </div>
  </main>

  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-title">
        <span class="bsky-logo"><svg viewBox="0 0 600 530" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M135.72 44.03C202.22 93.55 273.42 195.06 300 249.71C326.58 195.06 397.78 93.55 464.28 44.03C512.34 8.46 590 -19.9 590 68.2C590 86.15 580.59 232.75 574.58 256.57C555.16 333.52 470.98 354.41 396.2 341.73C527.35 363.77 558.75 435.78 493.5 507.8C368.69 645.65 313.43 488.45 302.22 454.2C300.78 449.88 300.08 447.86 300 449.16C299.92 447.86 299.22 449.88 297.78 454.2C286.57 488.45 231.31 645.65 106.5 507.8C41.25 435.78 72.65 363.77 203.8 341.73C129.02 354.41 44.84 333.52 25.42 256.57C19.41 232.75 10 86.15 10 68.2C10 -19.9 87.66 8.46 135.72 44.03Z" fill="#0085ff"/></svg></span>
        NBA BLUESKY BUZZ
      </div>
    </div>
    <div class="feed-container" id="feedContainer"></div>
  </aside>

  <div class="ticker-area">
    <div class="ticker-label">LATEST</div>
    <div class="ticker-track"><div class="ticker-content" id="tickerContent"></div></div>
  </div>
</div>

<script>
const CONFIG={gameRotateInterval:20000,screenDurations:[9000,15000,15000],rankingsRotateInterval:15000,tickerSpeed:50,autoModeHoursAfterLastGame:6,miniScoresVisible:5};

const MOCK_GAMES=[
  {id:'1',status:'live',period:'3RD QTR',periodNum:3,clock:'4:32',venue:'TD Garden, Boston',
   quarters:{away:[28,31,null,null],home:[30,27,null,null]},
   gameStats:{leadChanges:8,timesTied:5},
   away:{abbr:'BOS',city:'BOSTON',name:'Celtics',record:'38-12',score:89,
    leaders:{pts:{name:'J. Tatum',val:28},reb:{name:'K. Porzingis',val:9},ast:{name:'D. White',val:7}},
    stats:{fgPct:'48.2',threePct:'38.5',ftPct:'82.1',reb:32,ast:22,stl:6,blk:4,to:10,fastBreak:12,paint:34,benchPts:7,biggestLead:14},
    boxscore:{starters:[
      {num:'0',name:'J. Tatum',pos:'SF',min:'28',pts:28,reb:6,ast:4,stl:1,blk:0,fg:'10-19',three:'4-8',ft:'4-5',pm:'+7',to:3},
      {num:'7',name:'J. Brown',pos:'SG',min:'26',pts:18,reb:3,ast:3,stl:2,blk:0,fg:'7-14',three:'2-5',ft:'2-2',pm:'+5',to:2},
      {num:'8',name:'K. Porzingis',pos:'C',min:'24',pts:16,reb:9,ast:1,stl:0,blk:3,fg:'6-12',three:'2-4',ft:'2-3',pm:'+8',to:1},
      {num:'9',name:'D. White',pos:'PG',min:'27',pts:12,reb:3,ast:7,stl:2,blk:1,fg:'5-10',three:'2-5',ft:'0-0',pm:'+3',to:2},
      {num:'42',name:'A. Horford',pos:'PF',min:'20',pts:8,reb:5,ast:3,stl:0,blk:0,fg:'3-7',three:'1-3',ft:'1-2',pm:'+2',to:1}],
     bench:[
      {num:'11',name:'P. Pritchard',pos:'G',min:'14',pts:5,reb:1,ast:2,stl:1,blk:0,fg:'2-5',three:'1-3',ft:'0-0',pm:'-1',to:0},
      {num:'77',name:'S. Hauser',pos:'F',min:'10',pts:2,reb:2,ast:1,stl:0,blk:0,fg:'1-3',three:'0-2',ft:'0-0',pm:'-3',to:1}]}},
   home:{abbr:'LAL',city:'LOS ANGELES',name:'Lakers',record:'30-20',score:84,
    leaders:{pts:{name:'L. James',val:24},reb:{name:'A. Davis',val:11},ast:{name:'A. Reaves',val:6}},
    stats:{fgPct:'45.1',threePct:'33.3',ftPct:'78.6',reb:30,ast:19,stl:5,blk:3,to:12,fastBreak:8,paint:30,benchPts:3,biggestLead:6},
    boxscore:{starters:[
      {num:'23',name:'L. James',pos:'SF',min:'30',pts:24,reb:7,ast:5,stl:1,blk:1,fg:'9-18',three:'3-7',ft:'3-4',pm:'-3',to:3},
      {num:'3',name:'A. Davis',pos:'PF',min:'29',pts:20,reb:11,ast:2,stl:1,blk:2,fg:'8-16',three:'0-1',ft:'4-6',pm:'-2',to:2},
      {num:'15',name:'A. Reaves',pos:'SG',min:'27',pts:16,reb:3,ast:6,stl:2,blk:0,fg:'6-13',three:'2-5',ft:'2-2',pm:'-5',to:1},
      {num:'1',name:'D. Russell',pos:'PG',min:'24',pts:11,reb:2,ast:4,stl:1,blk:0,fg:'4-11',three:'2-6',ft:'1-1',pm:'-7',to:3},
      {num:'28',name:'R. Hachimura',pos:'PF',min:'22',pts:8,reb:4,ast:1,stl:0,blk:0,fg:'3-8',three:'1-3',ft:'1-2',pm:'-1',to:2}],
     bench:[
      {num:'2',name:'J. Vanderbilt',pos:'F',min:'12',pts:3,reb:2,ast:0,stl:0,blk:0,fg:'1-3',three:'0-0',ft:'1-2',pm:'+2',to:1}]}}},
  {id:'2',status:'live',period:'2ND QTR',periodNum:2,clock:'8:15',venue:'Footprint Center, Phoenix',
   quarters:{away:[28,null,null,null],home:[30,null,null,null]},
   gameStats:{leadChanges:4,timesTied:3},
   away:{abbr:'MIL',city:'MILWAUKEE',name:'Bucks',record:'32-18',score:48,
    leaders:{pts:{name:'G. Antetokounmpo',val:18},reb:{name:'G. Antetokounmpo',val:7},ast:{name:'D. Lillard',val:5}},
    stats:{fgPct:'46.8',threePct:'35.0',ftPct:'80.0',reb:18,ast:12,stl:3,blk:2,to:6,fastBreak:6,paint:20,benchPts:0,biggestLead:4},
    boxscore:{starters:[
      {num:'34',name:'G. Antetokounmpo',pos:'PF',min:'18',pts:18,reb:7,ast:3,stl:1,blk:1,fg:'7-12',three:'0-1',ft:'4-6',pm:'-2',to:2},
      {num:'0',name:'D. Lillard',pos:'PG',min:'18',pts:14,reb:1,ast:5,stl:1,blk:0,fg:'5-10',three:'3-6',ft:'1-1',pm:'-3',to:1},
      {num:'22',name:'K. Middleton',pos:'SF',min:'16',pts:8,reb:3,ast:2,stl:0,blk:0,fg:'3-7',three:'1-3',ft:'1-2',pm:'-1',to:1},
      {num:'5',name:'B. Portis',pos:'C',min:'14',pts:6,reb:4,ast:1,stl:0,blk:1,fg:'2-5',three:'1-2',ft:'1-1',pm:'0',to:1},
      {num:'11',name:'B. Lopez',pos:'C',min:'14',pts:2,reb:2,ast:1,stl:1,blk:0,fg:'1-4',three:'0-2',ft:'0-0',pm:'-2',to:1}],
     bench:[]}},
   home:{abbr:'PHX',city:'PHOENIX',name:'Suns',record:'29-21',score:52,
    leaders:{pts:{name:'K. Durant',val:20},reb:{name:'J. Nurkic',val:6},ast:{name:'D. Booker',val:4}},
    stats:{fgPct:'50.0',threePct:'40.0',ftPct:'85.7',reb:20,ast:14,stl:4,blk:1,to:5,fastBreak:10,paint:24,benchPts:0,biggestLead:8},
    boxscore:{starters:[
      {num:'35',name:'K. Durant',pos:'SF',min:'18',pts:20,reb:4,ast:3,stl:1,blk:1,fg:'8-14',three:'2-4',ft:'2-2',pm:'+4',to:1},
      {num:'1',name:'D. Booker',pos:'SG',min:'17',pts:14,reb:2,ast:4,stl:1,blk:0,fg:'5-10',three:'2-4',ft:'2-2',pm:'+3',to:2},
      {num:'27',name:'J. Nurkic',pos:'C',min:'15',pts:8,reb:6,ast:2,stl:0,blk:0,fg:'3-6',three:'0-0',ft:'2-3',pm:'+2',to:1},
      {num:'3',name:'B. Beal',pos:'SF',min:'14',pts:6,reb:3,ast:3,stl:1,blk:0,fg:'2-7',three:'1-3',ft:'1-1',pm:'+1',to:0},
      {num:'12',name:'G. Allen',pos:'PF',min:'12',pts:4,reb:3,ast:1,stl:1,blk:0,fg:'2-4',three:'0-1',ft:'0-0',pm:'+1',to:1}],
     bench:[]}}},
  {id:'3',status:'final',period:'FINAL',periodNum:4,clock:'',venue:'Chase Center, San Francisco',
   quarters:{away:[25,30,28,29],home:[28,27,26,24]},
   gameStats:{leadChanges:12,timesTied:7},
   away:{abbr:'DEN',city:'DENVER',name:'Nuggets',record:'35-15',score:112,
    leaders:{pts:{name:'N. Jokic',val:32},reb:{name:'N. Jokic',val:14},ast:{name:'N. Jokic',val:9}},
    stats:{fgPct:'52.3',threePct:'41.2',ftPct:'88.0',reb:42,ast:28,stl:7,blk:3,to:9,fastBreak:16,paint:48,benchPts:10,biggestLead:15},
    boxscore:{starters:[
      {num:'15',name:'N. Jokic',pos:'C',min:'36',pts:32,reb:14,ast:9,stl:2,blk:1,fg:'12-18',three:'2-3',ft:'6-7',pm:'+12',to:3},
      {num:'27',name:'J. Murray',pos:'PG',min:'34',pts:22,reb:3,ast:8,stl:1,blk:0,fg:'9-17',three:'3-6',ft:'1-1',pm:'+8',to:2},
      {num:'1',name:'M. Porter Jr.',pos:'SF',min:'32',pts:18,reb:7,ast:2,stl:0,blk:0,fg:'7-13',three:'3-5',ft:'1-2',pm:'+6',to:1},
      {num:'50',name:'A. Gordon',pos:'PF',min:'30',pts:14,reb:6,ast:3,stl:2,blk:1,fg:'6-10',three:'1-2',ft:'1-2',pm:'+5',to:1},
      {num:'5',name:'K. Caldwell-Pope',pos:'SG',min:'28',pts:12,reb:2,ast:2,stl:1,blk:0,fg:'4-8',three:'3-5',ft:'1-1',pm:'+4',to:1}],
     bench:[{num:'14',name:'C. Braun',pos:'G',min:'14',pts:6,reb:3,ast:2,stl:1,blk:1,fg:'2-5',three:'1-3',ft:'1-1',pm:'+1',to:0},
      {num:'0',name:'P. Watson',pos:'F',min:'10',pts:4,reb:4,ast:1,stl:0,blk:0,fg:'2-4',three:'0-1',ft:'0-0',pm:'-2',to:1}]}},
   home:{abbr:'GSW',city:'GOLDEN STATE',name:'Warriors',record:'28-22',score:105,
    leaders:{pts:{name:'S. Curry',val:29},reb:{name:'D. Green',val:8},ast:{name:'S. Curry',val:7}},
    stats:{fgPct:'47.8',threePct:'39.5',ftPct:'84.2',reb:38,ast:25,stl:5,blk:4,to:11,fastBreak:10,paint:40,benchPts:12,biggestLead:10},
    boxscore:{starters:[
      {num:'30',name:'S. Curry',pos:'PG',min:'36',pts:29,reb:4,ast:7,stl:1,blk:0,fg:'10-20',three:'5-11',ft:'4-4',pm:'-5',to:3},
      {num:'11',name:'K. Thompson',pos:'SG',min:'32',pts:22,reb:3,ast:2,stl:0,blk:0,fg:'8-16',three:'4-9',ft:'2-2',pm:'-3',to:2},
      {num:'22',name:'A. Wiggins',pos:'SF',min:'30',pts:18,reb:5,ast:2,stl:1,blk:1,fg:'7-14',three:'2-4',ft:'2-3',pm:'-4',to:2},
      {num:'23',name:'D. Green',pos:'PF',min:'32',pts:8,reb:8,ast:6,stl:2,blk:2,fg:'3-7',three:'1-3',ft:'1-2',pm:'-2',to:2},
      {num:'5',name:'K. Looney',pos:'C',min:'24',pts:6,reb:7,ast:2,stl:0,blk:1,fg:'3-5',three:'0-0',ft:'0-0',pm:'-6',to:1}],
     bench:[{num:'3',name:'J. Poole',pos:'G',min:'18',pts:12,reb:1,ast:3,stl:1,blk:0,fg:'4-9',three:'2-5',ft:'2-2',pm:'+2',to:1}]}}}
];

const MOCK_NEXT_GAMES=[{away:'OKC',home:'MIN',time:'Tomorrow 8:00 PM ET'},{away:'CLE',home:'BOS',time:'Tomorrow 7:30 PM ET'},{away:'DAL',home:'LAC',time:'Tomorrow 10:00 PM ET'},{away:'SAC',home:'HOU',time:'Wed 8:30 PM ET'}];

let salariesData=null;
let ratingsData=null;
let injuriesData=null;
let depthData=null;
let teamRatingsData=null;
let histSalariesData=null;
let countingStatsData=null;
let draftClassData=null;
let transactionsData=null;
let valueData=null;
let comparisonsData=null;
let previewsData=null;
let rankingsScreens=[];
let sectionStarts={};  // {teamRatings:0, depth:10, injuries:25, ratings:30, salaries:38}
function buildRankingsScreens(){
  rankingsScreens=[];
  sectionStarts={};
  // Team Rating screens (first)
  if(teamRatingsData&&teamRatingsData.screens){
    sectionStarts.teamRatings=rankingsScreens.length;
    for(const scr of teamRatingsData.screens){
      rankingsScreens.push({
        title:'Global Rating — '+scr.title,
        source:scr.subtitle,
        isRating:true,
        isForm:false,
        data:scr.players
      });
    }
  }
  // Counting stats screens
  if(countingStatsData&&countingStatsData.screens){
    sectionStarts.countingStats=rankingsScreens.length;
    for(const scr of countingStatsData.screens){
      const maxVal=Math.max(...scr.players.map(p=>p.value||0),1);
      rankingsScreens.push({
        title:scr.title,
        source:'NBA.com',
        isCountingStat:true,
        stat:scr.stat,
        maxValue:maxVal,
        data:scr.players
      });
    }
  }
  // Depth chart screens
  if(depthData&&depthData.screens){
    sectionStarts.depth=rankingsScreens.length;
    for(const scr of depthData.screens){
      rankingsScreens.push({
        title:'Depth Charts',
        source:'HoopsHype Depth Chart',
        isDepth:true,
        data:scr.teams
      });
    }
  }
  // Injury report screens
  if(injuriesData&&injuriesData.screens){
    sectionStarts.injuries=rankingsScreens.length;
    for(const scr of injuriesData.screens){
      rankingsScreens.push({
        title:'Injury Report',
        source:'HoopsHype',
        isInjury:true,
        left:scr.left,
        right:scr.right
      });
    }
  }
  // Global Rating screens
  if(ratingsData&&ratingsData.screens){
    sectionStarts.ratings=rankingsScreens.length;
    for(const scr of ratingsData.screens){
      rankingsScreens.push({
        title:scr.title,
        source:'HoopsHype Global Rating',
        isRating:true,
        isForm:scr.isForm||false,
        data:scr.players
      });
    }
  }
  // Draft class screens
  if(draftClassData&&draftClassData.screens){
    sectionStarts.draftClass=rankingsScreens.length;
    for(const scr of draftClassData.screens){
      rankingsScreens.push({
        title:scr.title,
        source:scr.subtitle,
        isRating:true,
        isForm:false,
        isLumped:scr.isLumped||false,
        data:scr.players.map(p=>({
          rank:p.rank,
          name:p.name,
          team:p.team,
          rating:p.ratingDisplay,
          games:p.games,
          pts:p.pts,
          reb:p.reb,
          ast:p.ast,
          country:p.country,
          draftYear:p.draftYear||''
        }))
      });
    }
  }
  // Transaction screens
  if(transactionsData&&transactionsData.screens){
    sectionStarts.transactions=rankingsScreens.length;
    for(const scr of transactionsData.screens){
      rankingsScreens.push({
        title:scr.title,
        source:scr.subtitle,
        isTransaction:true,
        data:scr.transactions
      });
    }
  }
  // Value ranking screens
  if(valueData&&valueData.screens){
    sectionStarts.value=rankingsScreens.length;
    for(const scr of valueData.screens){
      rankingsScreens.push({
        title:scr.title,
        source:scr.subtitle,
        isValue:true,
        isBestValue:scr.isBestValue,
        data:scr.players.map(p=>({
          rank:p.rank,
          name:p.name,
          team:p.team,
          rating:p.ratingDisplay,
          salary:p.salaryCompact,
          value:p.value,
          games:p.games,
          country:p.country
        }))
      });
    }
  }
  // Comparison screens (matchups, positional, All-Star H2H)
  if(comparisonsData&&comparisonsData.screens){
    sectionStarts.matchups=rankingsScreens.length;
    for(const scr of comparisonsData.screens){
      if(scr.isPositional){
        rankingsScreens.push({
          title:scr.title,
          source:scr.subtitle,
          isPositional:true,
          data:scr.players.map(p=>({
            rank:p.rank,name:p.name,team:p.team,
            rating:p.ratingDisplay,games:p.games,
            pts:p.pts,reb:p.reb,ast:p.ast,
            country:p.country
          }))
        });
      } else if(scr.isComparison){
        rankingsScreens.push({
          title:scr.title,
          source:scr.subtitle,
          isComparison:true,
          compType:scr.compType,
          playerA:scr.playerA,
          playerB:scr.playerB,
          sections:scr.sections,
          scoreA:scr.scoreA||0,
          scoreB:scr.scoreB||0
        });
      } else if(scr.isPreview){
        if(sectionStarts.previews===undefined) sectionStarts.previews=rankingsScreens.length;
        rankingsScreens.push({
          title:scr.title,
          source:scr.subtitle,
          isPreview:true,
          awayCity:scr.awayCity,
          homeCity:scr.homeCity,
          awayAbbr:scr.awayAbbr,
          homeAbbr:scr.homeAbbr,
          awayTeamId:scr.awayTeamId,
          homeTeamId:scr.homeTeamId,
          matchups:scr.matchups,
          awayTotals:scr.awayTotals,
          homeTotals:scr.homeTotals,
          awayInjuries:scr.awayInjuries||[],
          homeInjuries:scr.homeInjuries||[]
        });
      }
    }
  }
  // Salary screens
  if(salariesData&&salariesData.rankings){
    sectionStarts.salaries=rankingsScreens.length;
    const r=salariesData.rankings;
  // League-wide pages (15 per page)
  const pg1=r.slice(0,15),pg2=r.slice(15,30);
  if(pg1.length){rankingsScreens.push({title:'Team Salary Rankings 2025-26',source:'HoopsHype',columns:['Rank','Team','Total 25-26','Cap Space','Status'],data:pg1.map(t=>[t.rank,t.team,t.totalDisplay,t.capSpace,t.teamStatus])});}
  if(pg2.length){rankingsScreens.push({title:'Team Salary Rankings 2025-26',source:'HoopsHype',columns:['Rank','Team','Total 25-26','Cap Space','Status'],data:pg2.map(t=>[t.rank,t.team,t.totalDisplay,t.capSpace,t.teamStatus])});}
  // Team-by-team breakdown screens
  if(salariesData.teams){
    const teamNames=r.map(t=>t.team);
    for(const name of teamNames){
      const t=salariesData.teams[name];
      if(!t||!t.players||t.players.length===0)continue;
      const maxSal=Math.max(...t.players.map(p=>p.salary),1);
      rankingsScreens.push({
        title:`${name} — Roster Salaries`,
        source:`Rank: #${t.rank} | 25-26: ${t.totalDisplay} | 26-27: ${t.totalNextDisplay} | Cap Space: ${t.capSpace}`,
        columns:['Player','Salary','','Status'],
        isTeam:true,
        maxSalary:maxSal,
        data:t.players.map(p=>({
          name:p.name,
          country:p.country||'',
          sal:p.salaryDisplay,
          salNext:p.salaryNextDisplay||'—',
          salRaw:p.salary,
          status:p.status
        }))
      });
    }
  }
  }
  // Historical salary screens
  if(histSalariesData&&histSalariesData.screens){
    sectionStarts.histSalaries=rankingsScreens.length;
    for(const scr of histSalariesData.screens){
      const maxSal=Math.max(...scr.players.map(p=>p.salary),1);
      rankingsScreens.push({
        title:scr.title,
        source:'HoopsHype',
        isHistSalary:true,
        maxSalary:maxSal,
        data:scr.players
      });
    }
  }
}
function pollSalaries(){
  fetch('/api/salaries').then(r=>r.json()).then(data=>{
    if(data&&data.rankings&&data.rankings.length>0){
      salariesData=data;
      buildRankingsScreens();
      console.log('Salaries loaded:',data.count,'teams,',rankingsScreens.length,'screens');
    }
  }).catch(e=>console.warn('Salaries fetch error:',e));
}
function pollRatings(){
  fetch('/api/ratings').then(r=>r.json()).then(data=>{
    if(data&&data.screens&&data.screens.length>0){
      ratingsData=data;
      buildRankingsScreens();
      console.log('Ratings loaded:',data.count,'screens, total:',rankingsScreens.length);
    }
  }).catch(e=>console.warn('Ratings fetch error:',e));
}
function pollInjuries(){
  fetch('/api/injuries').then(r=>r.json()).then(data=>{
    if(data&&data.screens&&data.screens.length>0){
      injuriesData=data;
      buildRankingsScreens();
      console.log('Injuries loaded:',data.count,'screens, total:',rankingsScreens.length);
    }
  }).catch(e=>console.warn('Injuries fetch error:',e));
}
function pollDepth(){
  fetch('/api/depth').then(r=>r.json()).then(data=>{
    if(data&&data.screens&&data.screens.length>0){
      depthData=data;
      buildRankingsScreens();
      console.log('Depth charts loaded:',data.count,'screens, total:',rankingsScreens.length);
    }
  }).catch(e=>console.warn('Depth fetch error:',e));
}
function pollTeamRatings(){
  fetch('/api/team_ratings').then(r=>r.json()).then(data=>{
    if(data&&data.screens&&data.screens.length>0){
      teamRatingsData=data;
      buildRankingsScreens();
      console.log('Team ratings loaded:',data.count,'screens, total:',rankingsScreens.length);
    }
  }).catch(e=>console.warn('Team ratings fetch error:',e));
}
function pollHistSalaries(){
  fetch('/api/hist_salaries').then(r=>r.json()).then(data=>{
    if(data&&data.screens&&data.screens.length>0){
      histSalariesData=data;
      buildRankingsScreens();
      console.log('Historical salaries loaded:',data.count,'screens');
    }
  }).catch(e=>console.warn('Historical salaries fetch error:',e));
}
function pollCountingStats(){
  fetch('/api/counting_stats').then(r=>r.json()).then(data=>{
    if(data&&data.screens&&data.screens.length>0){
      countingStatsData=data;
      buildRankingsScreens();
      console.log('Counting stats loaded:',data.count,'screens');
    }
  }).catch(e=>console.warn('Counting stats fetch error:',e));
}
function pollDraftClasses(){
  fetch('/api/draft_classes').then(r=>r.json()).then(data=>{
    if(data&&data.screens&&data.screens.length>0){
      draftClassData=data;
      buildRankingsScreens();
      console.log('Draft classes loaded:',data.count,'screens');
    }
  }).catch(e=>console.warn('Draft classes fetch error:',e));
}
function pollTransactions(){
  fetch('/api/transactions').then(r=>r.json()).then(data=>{
    if(data&&data.screens&&data.screens.length>0){
      transactionsData=data;
      buildRankingsScreens();
      console.log('Transactions loaded:',data.count,'screens');
    }
  }).catch(e=>console.warn('Transactions fetch error:',e));
}
function pollValue(){
  fetch('/api/value').then(r=>r.json()).then(data=>{
    if(data&&data.screens&&data.screens.length>0){
      valueData=data;
      buildRankingsScreens();
      console.log('Value rankings loaded:',data.count,'screens');
    }
  }).catch(e=>console.warn('Value rankings fetch error:',e));
}
function pollComparisons(){
  fetch('/api/comparisons').then(r=>r.json()).then(data=>{
    if(data&&data.screens&&data.screens.length>0){
      comparisonsData=data;
      buildRankingsScreens();
      console.log('Comparisons loaded:',data.count,'screens');
    }
  }).catch(e=>console.warn('Comparisons fetch error:',e));
}
function pollPreviews(){
  fetch('/api/previews').then(r=>r.json()).then(data=>{
    if(data&&data.screens&&data.screens.length>0){
      previewsData=data;
      buildRankingsScreens();
      console.log('Previews loaded:',data.count,'screens');
    }
  }).catch(e=>console.warn('Previews fetch error:',e));
}
pollSalaries();
pollRatings();
pollInjuries();
pollDepth();
pollTeamRatings();
pollHistSalaries();
pollCountingStats();
pollDraftClasses();
pollTransactions();
pollValue();
pollComparisons();
pollPreviews();
setInterval(pollSalaries,30*60*1000);
setInterval(pollRatings,30*60*1000);
setInterval(pollInjuries,15*60*1000);
setInterval(pollDepth,30*60*1000);
setInterval(pollTeamRatings,30*60*1000);
setInterval(pollHistSalaries,60*60*1000);
setInterval(pollCountingStats,30*60*1000);
setInterval(pollDraftClasses,30*60*1000);
setInterval(pollTransactions,15*60*1000);
setInterval(pollValue,30*60*1000);
setInterval(pollComparisons,5*60*1000);
setInterval(pollPreviews,15*60*1000);

const MOCK_HEADLINES=[
  {text:'Lakers exploring trade options for additional wing depth ahead of deadline',isNew:true,time:'12m'},
  {text:'Celtics\' Jayson Tatum expected to return from knee soreness by Friday',isNew:true,time:'28m'},
  {text:'Warriors reportedly interested in veteran center to bolster frontcourt',isNew:true,time:'45m'},
  {text:'Knicks and Heat discussed potential Sixth Man swap last week, per sources',isNew:false,time:'1h'},
  {text:'Thunder GM Sam Presti: "We like where our roster is right now"',isNew:false,time:'2h'},
  {text:'Pelicans open to moving expiring contracts for future assets',isNew:false,time:'2h'},
  {text:'Nikola Jokic posts 4th triple-double in five games as Nuggets roll',isNew:false,time:'3h'},
  {text:'Bucks exploring wing upgrades as trade deadline approaches',isNew:false,time:'3h'},
  {text:'Spurs\' Wembanyama named Western Conference Player of the Week',isNew:false,time:'4h'},
  {text:'Mavericks could be in the market for a backup point guard, sources say',isNew:false,time:'5h'},
];

const MOCK_FEED=[
  {author:'Adrian Wojnarowski',handle:'@wojespn.bsky',avatar:'AW',time:'5m',text:'The Lakers and Pacers have engaged in preliminary discussions centered around a wing rotation player, league sources tell me.'},
  {author:'Shams Charania',handle:'@shamscharania.bsky',avatar:'SC',time:'18m',text:'Sources: The Celtics are finalizing a deal to bring in additional frontcourt depth before the trade deadline.'},
  {author:'Chris Haynes',handle:'@chaynes.bsky',avatar:'CH',time:'32m',text:'Nuggets star Nikola Jokic told reporters after tonight\'s win: "We\'re playing our best basketball right now."'},
  {author:'Marc Stein',handle:'@marcstein.bsky',avatar:'MS',time:'45m',text:'League sources say the Thunder have emerged as dark-horse contenders for the No. 1 seed in the West.'},
  {author:'Jake Fischer',handle:'@jakelfischer.bsky',avatar:'JF',time:'1h',text:'Multiple teams have called the Raptors about Pascal Siakam\'s availability. Toronto seeking young talent and picks.'},
  {author:'Brian Windhorst',handle:'@bwindhorst.bsky',avatar:'BW',time:'1h',text:'The trade deadline is shaping up to be one of the busiest in recent memory. Tracking at least 8 active negotiations.'},
  {author:'Kevin O\'Connor',handle:'@kevinoconnor.bsky',avatar:'KO',time:'2h',text:'Film thread: Why Wembanyama\'s defensive impact goes way beyond his block numbers. His contest rate is historically elite.'},
];

// ═══ CLOCK (ET) ═══
function updateClock(){
  const now=new Date();
  const et=new Date(now.toLocaleString('en-US',{timeZone:'America/New_York'}));
  document.getElementById('clockDisplay').textContent=et.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true});
  document.getElementById('dateDisplay').textContent=et.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'});
}
setInterval(updateClock,1000);updateClock();

// ═══ QUARTER SCORES HTML ═══
function renderQuarters(game,prefix){
  const awayQ=game.quarters.away;const homeQ=game.quarters.home;
  const len=Math.max(awayQ.length,homeQ.length,4);
  const labels=[];for(let i=0;i<len;i++)labels.push(i<4?'Q'+(i+1):(i===4?'OT':'OT'+(i-3)));
  return `<div class="${prefix}-quarters">${labels.map((q,i)=>{
    const aVal=awayQ[i]!==undefined?awayQ[i]:null;
    const hVal=homeQ[i]!==undefined?homeQ[i]:null;
    const isCurrent=i+1===game.periodNum&&game.status==='live';
    const aHi=aVal!==null&&hVal!==null&&aVal>hVal?' highlight':'';
    const hHi=aVal!==null&&hVal!==null&&hVal>aVal?' highlight':'';
    return `<div class="${prefix}-q-col">
      <div class="${prefix}-q-header">${q}</div>
      <div class="${prefix}-q-val${isCurrent?' current':''}${aHi}">${aVal!==null?aVal:'—'}</div>
      <div class="${prefix}-q-val${isCurrent?' current':''}${hHi}">${hVal!==null?hVal:'—'}</div>
    </div>`;
  }).join('')}<div class="${prefix}-q-col">
    <div class="${prefix}-q-header">T</div>
    <div class="${prefix}-q-val" style="font-weight:700;color:var(--text-primary)">${game.away.score}</div>
    <div class="${prefix}-q-val" style="font-weight:700;color:var(--text-primary)">${game.home.score}</div>
  </div></div>`;
}

// ═══ SCORE FLOW CHART (SVG) ═══
function renderScoreFlow(g){
  const aQ=g.quarters.away,hQ=g.quarters.home;
  let aCum=[0],hCum=[0];
  for(let i=0;i<aQ.length;i++){
    if(aQ[i]===null||hQ[i]===null)break;
    aCum.push(aCum[aCum.length-1]+aQ[i]);
    hCum.push(hCum[hCum.length-1]+hQ[i]);
  }
  if(aCum.length<=1)return '';
  const maxS=Math.max(...aCum,...hCum,1);
  const n=aCum.length;
  const W=480,H=72,padL=28,padR=32,padT=8,padB=16;
  const plotW=W-padL-padR,plotH=H-padT-padB;
  function x(i){return padL+i/(n-1)*plotW;}
  function y(v){return padT+plotH-v/maxS*plotH;}
  const aLine=aCum.map((v,i)=>`${x(i).toFixed(1)},${y(v).toFixed(1)}`).join(' ');
  const hLine=hCum.map((v,i)=>`${x(i).toFixed(1)},${y(v).toFixed(1)}`).join(' ');
  const labels=['0'];for(let i=1;i<n;i++)labels.push(i<=4?'Q'+i:(i===5?'OT':'OT'+(i-4)));
  return `<div class="s1-flow-panel">
    <div class="s1-panel-title" style="margin-bottom:var(--sp-1)">Score Flow</div>
    <svg viewBox="0 0 ${W} ${H}" class="score-flow-svg" preserveAspectRatio="xMidYMid meet">
      ${aCum.map((_,i)=>`<line x1="${x(i).toFixed(1)}" y1="${padT}" x2="${x(i).toFixed(1)}" y2="${H-padB}" stroke="rgba(255,255,255,0.04)"/>`).join('')}
      <line x1="${padL}" y1="${y(0).toFixed(1)}" x2="${padL+plotW}" y2="${y(0).toFixed(1)}" stroke="rgba(255,255,255,0.03)"/>
      <polyline points="${aLine}" fill="none" stroke="var(--accent)" stroke-width="2.5" stroke-linejoin="round" stroke-linecap="round"/>
      <polyline points="${hLine}" fill="none" stroke="#6B7585" stroke-width="2.5" stroke-linejoin="round" stroke-linecap="round"/>
      ${aCum.map((v,i)=>`<circle cx="${x(i).toFixed(1)}" cy="${y(v).toFixed(1)}" r="3" fill="var(--accent)"/>`).join('')}
      ${hCum.map((v,i)=>`<circle cx="${x(i).toFixed(1)}" cy="${y(v).toFixed(1)}" r="3" fill="#6B7585"/>`).join('')}
      ${labels.map((l,i)=>`<text x="${x(i).toFixed(1)}" y="${H-2}" text-anchor="middle" fill="var(--text-muted)" style="font-size:8px;font-family:var(--font-display)">${l}</text>`).join('')}
      <text x="${(x(n-1)+4).toFixed(1)}" y="${(y(aCum[n-1])+1).toFixed(1)}" fill="var(--accent)" style="font-size:9px;font-weight:700;font-family:var(--font-mono)" dominant-baseline="middle">${aCum[n-1]}</text>
      <text x="${(x(n-1)+4).toFixed(1)}" y="${(y(hCum[n-1])+1).toFixed(1)}" fill="#6B7585" style="font-size:9px;font-weight:700;font-family:var(--font-mono)" dominant-baseline="middle">${hCum[n-1]}</text>
    </svg>
    <div class="flow-legend">
      <span class="flow-legend-item"><span class="flow-dot" style="background:var(--accent)"></span>${g.away.abbr}</span>
      <span class="flow-legend-item"><span class="flow-dot" style="background:#6B7585"></span>${g.home.abbr}</span>
    </div>
  </div>`;
}

// ═══ SCREEN 1: BIG SCOREBOARD ═══
function renderScreen1(g){
  const s=g.away.stats,h=g.home.stats;
  const better=(a,b,lower)=>lower?parseFloat(a)<parseFloat(b):parseFloat(a)>parseFloat(b);
  const stats=[['FG%',s.fgPct,h.fgPct],['3PT%',s.threePct,h.threePct],['FT%',s.ftPct,h.ftPct],['REB',s.reb,h.reb],['AST',s.ast,h.ast],['STL',s.stl,h.stl],['BLK',s.blk,h.blk],['TO',s.to,h.to],['FAST BRK',s.fastBreak,h.fastBreak],['PAINT',s.paint,h.paint],['BENCH',s.benchPts,h.benchPts],['BIG LEAD',s.biggestLead,h.biggestLead]];
  const gs=g.gameStats||{};
  return `
    <div class="s1-top">
      <div><div class="s1-label">${g.status==='final'?'FINAL SCORE':'FEATURED GAME'}</div><div class="s1-venue">${g.venue}</div></div>
      <div class="s1-period-row">
        <span class="s1-period-badge">${g.period}</span>
        ${g.clock?`<span class="s1-clock">${g.clock}</span>`:''}
      </div>
    </div>
    <div class="s1-scoreboard">
      <div class="s1-team-side">
        <div class="s1-team-logo" data-fb="${g.away.abbr}">${g.away.teamId?`<img src="https://cdn.nba.com/logos/nba/${g.away.teamId}/primary/L/logo.svg" alt="${g.away.abbr}" onerror="this.parentElement.innerHTML=this.parentElement.dataset.fb">`:g.away.abbr}</div>
        <div class="s1-team-info"><div class="s1-team-city">${g.away.city}</div><div class="s1-team-name">${g.away.name}</div><div class="s1-team-record">${g.away.record}</div></div>
      </div>
      <div class="s1-score-center">
        <div class="s1-scores-row">
          <span class="s1-big-score ${g.away.score>=g.home.score?'leading':''}">${g.away.score}</span>
          <span class="s1-score-sep">–</span>
          <span class="s1-big-score ${g.home.score>g.away.score?'leading':''}">${g.home.score}</span>
        </div>
        ${renderQuarters(g,'s1')}
      </div>
      <div class="s1-team-side home">
        <div class="s1-team-info" style="align-items:flex-end"><div class="s1-team-city">${g.home.city}</div><div class="s1-team-name">${g.home.name}</div><div class="s1-team-record">${g.home.record}</div></div>
        <div class="s1-team-logo" data-fb="${g.home.abbr}">${g.home.teamId?`<img src="https://cdn.nba.com/logos/nba/${g.home.teamId}/primary/L/logo.svg" alt="${g.home.abbr}" onerror="this.parentElement.innerHTML=this.parentElement.dataset.fb">`:g.home.abbr}</div>
      </div>
    </div>
    <div class="s1-bottom">
      <div class="s1-stats-panel">
        <div class="s1-panel-title">Team Stats</div>
        ${stats.map(([label,aVal,hVal])=>{const isTO=label==='TO';return `<div class="stat-compare-row"><div class="scv-left ${better(aVal,hVal,isTO)?'better':''}">${aVal}</div><div class="scv-label">${label}</div><div class="scv-right ${better(hVal,aVal,isTO)?'better':''}">${hVal}</div></div>`;}).join('')}
        <div class="stat-center-row"><span class="scv-center-val">${gs.leadChanges||0}</span><span class="scv-center-label">LEAD CHG</span><span class="scv-center-val">${gs.timesTied||0}</span><span class="scv-center-label">TIMES TIED</span></div>
      </div>
      <div class="s1-stats-panel">
        <div class="s1-panel-title">Game Leaders</div>
        ${[g.away,g.home].map(t=>{const L=t.leaders;return`<div class="leaders-team-name">${t.name}</div><div class="leaders-grid">${[['pts','PTS'],['blk','BLK'],['reb','REB'],['stl','STL'],['ast','AST'],['threepm','3PT'],['to','TO'],['pm','+/-']].map(([k,lb])=>{const l=L[k]||{name:'—',val:0};return`<div class="leader-row"><span class="leader-stat-type">${lb}</span><span class="leader-player">${l.name}</span><span class="leader-value">${k==='pm'&&l.val>0?'+'+l.val:l.val}</span></div>`;}).join('')}</div>`;}).join('')}
      </div>
      ${renderScoreFlow(g)}
    </div>`;
}

// ═══ SCREENS 2 & 3: BOXSCORE ═══
function renderBoxscore(g,side){
  const team=g[side],opp=side==='away'?g.home:g.away;
  const cols=['MIN','PTS','FG','3PT','FT','REB','AST','STL','BLK','TO','+/-'];
  const keys=['min','pts','fg','three','ft','reb','ast','stl','blk','to','pm'];
  const allPlayers=[...team.boxscore.starters,...team.boxscore.bench];
  // Highlight leaders — single best player per stat with tiebreakers
  function getMins(p){return parseInt(p.min)||0;}
  function getMakes(str){return parseInt(str.split('-')[0])||0;}
  function sPct(str,ma){const[m,a]=str.split('-').map(Number);return a>=ma?m/a:-1;}
  // Counting stats: max value → fewest minutes
  function pickBestCounting(stat){
    const maxVal=Math.max(0,...allPlayers.map(p=>p[stat]));
    if(maxVal<=0)return null;
    const tied=allPlayers.filter(p=>p[stat]===maxVal);
    return tied.length===1?tied[0]:tied.reduce((best,p)=>getMins(p)<getMins(best)?p:best);
  }
  // +/-: max value → fewest minutes
  function pickBestPm(){
    const maxVal=Math.max(...allPlayers.map(p=>parseInt(p.pm)||0));
    if(maxVal===0)return null;
    const tied=allPlayers.filter(p=>(parseInt(p.pm)||0)===maxVal);
    return tied.length===1?tied[0]:tied.reduce((best,p)=>getMins(p)<getMins(best)?p:best);
  }
  // Percentage stats: best pct (min attempts) → most makes → fewest minutes
  function pickBestPct(key,minAtt){
    const maxPct=Math.max(-1,...allPlayers.map(p=>sPct(p[key],minAtt)));
    if(maxPct<=0)return null;
    const tied=allPlayers.filter(p=>Math.abs(sPct(p[key],minAtt)-maxPct)<1e-4);
    if(tied.length===1)return tied[0];
    const maxMk=Math.max(...tied.map(p=>getMakes(p[key])));
    const tied2=tied.filter(p=>getMakes(p[key])===maxMk);
    return tied2.length===1?tied2[0]:tied2.reduce((best,p)=>getMins(p)<getMins(best)?p:best);
  }
  const hiMap={pts:pickBestCounting('pts'),reb:pickBestCounting('reb'),ast:pickBestCounting('ast'),stl:pickBestCounting('stl'),blk:pickBestCounting('blk'),to:pickBestCounting('to'),pm:pickBestPm(),fg:pickBestPct('fg',5),three:pickBestPct('three',3),ft:pickBestPct('ft',3)};
  function isHi(p,k){if(k==='min')return false;return hiMap[k]===p;}
  const totals={pts:allPlayers.reduce((s,p)=>s+p.pts,0),reb:allPlayers.reduce((s,p)=>s+p.reb,0),ast:allPlayers.reduce((s,p)=>s+p.ast,0),stl:allPlayers.reduce((s,p)=>s+p.stl,0),blk:allPlayers.reduce((s,p)=>s+p.blk,0),to:allPlayers.reduce((s,p)=>s+p.to,0)};
  function sumShooting(players,key){let m=0,a=0;players.forEach(p=>{const[mm,aa]=p[key].split('-').map(Number);m+=mm;a+=aa;});return{made:m,att:a,str:`${m}-${a}`,pct:a>0?(m/a*100).toFixed(1)+'%':'—'};}
  const fgT=sumShooting(allPlayers,'fg'),threeT=sumShooting(allPlayers,'three'),ftT=sumShooting(allPlayers,'ft');
  function bsLogo(t){return`<div class="bs-team-logo" data-fb="${t.abbr}">${t.teamId?`<img src="https://cdn.nba.com/logos/nba/${t.teamId}/primary/L/logo.svg" alt="${t.abbr}" onerror="this.parentElement.innerHTML=this.parentElement.dataset.fb">`:t.abbr}</div>`;}
  return `
    <div class="bs-scoreboard">
      <div class="bs-team-side">${bsLogo(g.away)}<div><div class="bs-team-name">${g.away.name}</div><div class="bs-team-record">${g.away.record}</div></div></div>
      <div class="bs-score-center">
        <div class="bs-scores-row"><span class="bs-big-score ${g.away.score>=g.home.score?'leading':''}">${g.away.score}</span><span class="bs-score-sep">–</span><span class="bs-big-score ${g.home.score>g.away.score?'leading':''}">${g.home.score}</span></div>
        ${renderQuarters(g,'bs')}
        ${g.clock?`<div class="bs-period-clock">${g.period} — ${g.clock}</div>`:`<div class="bs-period-clock" style="color:var(--text-tertiary)">${g.period}</div>`}
      </div>
      <div class="bs-team-side home"><div><div class="bs-team-name">${g.home.name}</div><div class="bs-team-record">${g.home.record}</div></div>${bsLogo(g.home)}</div>
    </div>
    <div class="bs-tabs">
      <div class="bs-tab ${side==='away'?'active':''}">${side==='away'?`<div class="bs-tab-dot"></div>`:''} ${g.away.city} ${g.away.name.toUpperCase()}</div>
      <div class="bs-tab ${side==='home'?'active':''}">${side==='home'?`<div class="bs-tab-dot"></div>`:''} ${g.home.city} ${g.home.name.toUpperCase()}</div>
    </div>
    <div class="bs-table-wrap">
      <table class="bs-table">
        <thead><tr><th>PLAYER</th>${cols.map(c=>`<th>${c}</th>`).join('')}</tr></thead>
        <tbody>
          <tr class="section-label"><td colspan="${cols.length+1}">STARTERS</td></tr>
          ${team.boxscore.starters.map(p=>`<tr><td>${p.name} <span class="player-num">#${p.num}</span></td>${keys.map(k=>`<td${isHi(p,k)?' class="highlight"':''}>${p[k]}</td>`).join('')}</tr>`).join('')}
          ${team.boxscore.bench.length?`<tr class="section-label"><td colspan="${cols.length+1}">BENCH</td></tr>${team.boxscore.bench.map(p=>`<tr><td>${p.name} <span class="player-num">#${p.num}</span></td>${keys.map(k=>`<td${isHi(p,k)?' class="highlight"':''}>${p[k]}</td>`).join('')}</tr>`).join('')}`:''}
        </tbody>
        <tfoot><tr><td>TEAM</td><td></td><td>${totals.pts}</td><td>${fgT.str}<span class="pct">${fgT.pct}</span></td><td>${threeT.str}<span class="pct">${threeT.pct}</span></td><td>${ftT.str}<span class="pct">${ftT.pct}</span></td><td>${totals.reb}</td><td>${totals.ast}</td><td>${totals.stl}</td><td>${totals.blk}</td><td>${totals.to}</td><td></td></tr></tfoot>
      </table>
    </div>`;
}

function renderGameScreens(g){
  document.getElementById('screen1').innerHTML=renderScreen1(g);
  document.getElementById('screen2').innerHTML=renderBoxscore(g,'away');
  document.getElementById('screen3').innerHTML=renderBoxscore(g,'home');
}

// ═══ SCREEN ROTATION (per-screen timing) ═══
let currentScreen=0;
let screenTimer=null;
const SCREENS=['screen1','screen2','screen3'];
function rotateScreen(){
  const prev=currentScreen;
  const next=(currentScreen+1)%3;
  if(next===0){rotateGame();return;}
  currentScreen=next;
  const prevEl=document.getElementById(SCREENS[prev]);
  prevEl.classList.remove('active');prevEl.classList.add('exit-left');
  setTimeout(()=>prevEl.classList.remove('exit-left'),500);
  document.getElementById(SCREENS[currentScreen]).classList.add('active');
  document.querySelectorAll('#screenDots .screen-dot').forEach((d,i)=>d.classList.toggle('active',i===currentScreen));
  scheduleNextScreen();
}
function scheduleNextScreen(){
  if(screenTimer)clearTimeout(screenTimer);
  // Duration for the CURRENT screen (how long it stays visible)
  const dur=CONFIG.screenDurations[currentScreen]||9000;
  screenTimer=setTimeout(rotateScreen,dur);
}

let lastShownGameId=null;
let rotationCount=0;
function getGames(){return liveGames&&liveGames.length>0?liveGames:MOCK_GAMES;}
function pickNextGame(allGames){
  const live=allGames.filter(g=>g.status==='live');
  const finals=allGames.filter(g=>g.status==='final');
  const playable=[...live,...finals];
  if(playable.length===0)return null;
  if(playable.length===1)return playable[0];
  rotationCount++;
  // All final: cycle evenly
  if(live.length===0){
    let opts=finals.filter(g=>g.id!==lastShownGameId);
    if(opts.length===0)opts=finals;
    return opts[rotationCount%opts.length];
  }
  // Mix of live + final: show live 3 out of 4 rotations, final 1 out of 4
  const showFinal=finals.length>0&&rotationCount%4===0;
  if(showFinal){
    let opts=finals.filter(g=>g.id!==lastShownGameId);
    if(opts.length===0)opts=finals;
    return opts[rotationCount%opts.length];
  }
  // Pick from live games, weighted by closeness (close=2x, blowout=1x)
  const close=live.filter(g=>Math.abs(g.away.score-g.home.score)<=10);
  const blowout=live.filter(g=>Math.abs(g.away.score-g.home.score)>10);
  let pool=[];
  close.forEach(g=>{pool.push(g);pool.push(g);});
  blowout.forEach(g=>pool.push(g));
  if(pool.length===0)pool=live;
  let opts=pool.filter(g=>g.id!==lastShownGameId);
  if(opts.length===0)opts=pool;
  return opts[rotationCount%opts.length];
}
function rotateGame(){
  const allGames=getGames();
  const pick=pickNextGame(allGames);
  if(!pick)return;
  lastShownGameId=pick.id;
  currentScreen=0;
  SCREENS.forEach((id,i)=>{const el=document.getElementById(id);el.classList.remove('active','exit-left');if(i===0)el.classList.add('active');});
  document.querySelectorAll('#screenDots .screen-dot').forEach((d,i)=>d.classList.toggle('active',i===0));
  renderGameScreens(pick);
  renderMiniScores(allGames,pick.id);
  scheduleNextScreen();
}

function renderMiniScores(games,activeId){
  const track=document.getElementById('miniScoresTrack');
  track.innerHTML=games.map(g=>{
    // Find game leaders (best across both teams for PTS/REB/AST)
    let leadersHtml='';
    if(g.status!=='scheduled' && g.away.leaders && g.home.leaders){
      const cats=['pts','reb','ast'];
      const labels=['PTS','REB','AST'];
      const ldrs=cats.map((c,i)=>{
        const aw=g.away.leaders[c]||{name:'—',val:0};
        const hm=g.home.leaders[c]||{name:'—',val:0};
        const best=(aw.val||0)>=(hm.val||0)?aw:hm;
        return `<span class="mini-ldr">${labels[i]}: ${best.name} ${best.val}</span>`;
      });
      leadersHtml=`<div class="mini-leaders">${ldrs.join('')}</div>`;
    }
    return `<div class="mini-game ${g.id===activeId?'active':''}" data-gid="${g.id}"><div class="mini-period ${g.status==='final'?'final':''}">${g.status==='final'?'FINAL':(g.status==='scheduled'?g.clock||'—':(g.period?g.period+' '+g.clock:g.clock))}</div><div class="mini-teams"><div class="mini-team-row">${g.away.teamId?`<img class="mini-team-logo" src="https://cdn.nba.com/logos/nba/${g.away.teamId}/primary/L/logo.svg" onerror="this.style.display='none'">`:''}<span class="mini-team-abbr">${g.away.abbr}</span><span class="mini-score ${g.away.score>g.home.score?'leading':''}">${g.away.score}</span></div><div class="mini-team-row">${g.home.teamId?`<img class="mini-team-logo" src="https://cdn.nba.com/logos/nba/${g.home.teamId}/primary/L/logo.svg" onerror="this.style.display='none'">`:''}<span class="mini-team-abbr">${g.home.abbr}</span><span class="mini-score ${g.home.score>g.away.score?'leading':''}">${g.home.score}</span></div></div>${leadersHtml}</div>`;
  }).join('');
  // Scroll track so active game is centered
  requestAnimationFrame(()=>{
    const container=document.getElementById('miniScores');
    const activeEl=track.querySelector('.mini-game.active');
    if(!activeEl||games.length<=CONFIG.miniScoresVisible)return track.style.transform='translateX(0)';
    const containerW=container.offsetWidth;
    const elLeft=activeEl.offsetLeft;
    const elW=activeEl.offsetWidth;
    const targetX=elLeft-(containerW/2)+(elW/2);
    const maxScroll=track.scrollWidth-containerW;
    const clampedX=Math.max(0,Math.min(targetX,maxScroll));
    track.style.transform=`translateX(-${clampedX}px)`;
  });
}

function renderTicker(headlines){
  const items=[...headlines,...headlines];
  const c=document.getElementById('tickerContent');
  c.innerHTML=items.map(h=>`<div class="ticker-item">${h.isNew?'<span class="ticker-badge">NEW</span>':''}<span class="ticker-headline">${h.text}</span><span class="ticker-time">${h.time}</span></div><span class="ticker-sep">●</span>`).join('');
  requestAnimationFrame(()=>{const w=c.scrollWidth/2;c.style.animationDuration=(w/CONFIG.tickerSpeed)+'s';});
}

function renderFeed(posts){
  const fc=document.getElementById('feedContainer');
  fc.innerHTML=posts.map((p,i)=>{
    const fb=`<div class="post-avatar">${p.avatar}</div>`;
    const av=p.avatarUrl
      ?`<img class="post-avatar-img" src="${p.avatarUrl}" alt="" width="28" height="28" onerror="this.parentElement.innerHTML=this.parentElement.dataset.fb">`
      :fb;
    const txt=p.text.length>280?p.text.slice(0,277)+'...':p.text;
    // Images
    let imgHtml='';
    if(p.images&&p.images.length>0){
      imgHtml=`<div class="post-images">${p.images.map(u=>`<img class="post-img" src="${u}" alt="" loading="lazy" onerror="this.style.display='none'">`).join('')}</div>`;
    }
    // Quote post
    let quoteHtml='';
    if(p.quote&&p.quote.text){
      const qt=p.quote.text.length>160?p.quote.text.slice(0,157)+'...':p.quote.text;
      quoteHtml=`<div class="post-quote"><div class="post-quote-author">${p.quote.author||''} <span class="post-quote-handle">${p.quote.handle||''}</span></div><div class="post-quote-text">${qt}</div></div>`;
    }
    return `<div class="feed-post" style="animation-delay:${i*0.05}s"><div class="post-header"><div class="post-avatar-wrap" data-fb="${fb.replace(/"/g,'&quot;')}">${av}</div><div class="post-meta"><div class="post-author">${p.author}</div><div class="post-handle">${p.handle}</div></div><div class="post-time">${p.time}</div></div><div class="post-text">${txt}</div>${imgHtml}${quoteHtml}</div>`;
  }).join('');
}

let currentRankingIndex=0;
function renderRankings(r){
  const p=document.getElementById('rankingsPanel');
  p.style.animation='none';p.offsetHeight;p.style.animation='';
  const total=rankingsScreens.length||1;
  const dots=total<=10
    ?rankingsScreens.map((_,i)=>`<div class="rankings-progress-dot ${i===currentRankingIndex?'active':''}"></div>`).join('')
    :`<span style="font-family:var(--font-mono);font-size:12px;color:var(--text-tertiary)">${currentRankingIndex+1} / ${total}</span>`;
  if(r.isCountingStat){
    const maxVal=r.maxValue||1;
    const statLabel=r.stat;
    const rows=r.data.map(p=>{
      const pct=Math.max(2,Math.round(Math.abs(p.value||0)/maxVal*100));
      const flagHtml=p.country?` <img class="sal-flag" src="https://flagcdn.com/w20/${p.country}.png" alt="" width="20" height="15">`:'';
      return `<tr>
        <td class="rat-rank"><span class="rank-num ${p.rank<=3?'top-3':''}">${p.rank}</span></td>
        <td class="sal-player">${p.name}${flagHtml}</td>
        <td class="hist-team">${p.team}</td>
        <td class="rat-stat">${p.gp}</td>
        <td class="rat-val">${p.valueDisplay}</td>
        <td class="sal-bar-cell"><div class="sal-bar" style="width:${pct}%"></div></td>
      </tr>`;
    }).join('');
    p.innerHTML=`<div class="rankings-header"><div><div class="rankings-title">${r.title}</div><div class="rankings-source">${r.source}</div></div><div class="rankings-progress">${dots}</div></div>
      <div class="sal-table-wrap"><table class="sal-table">
        <thead><tr><th class="rat-th-rank">#</th><th class="rat-th-player">PLAYER</th><th class="hist-th-team">TEAM</th><th class="rat-th-g">GP</th><th class="rat-th-rat">${statLabel}</th><th class="rat-th-bar"></th></tr></thead>
        <tbody>${rows}</tbody>
      </table></div>`;
  } else if(r.isValue){
    const maxVal=Math.max(...r.data.map(p=>p.value||0),1);
    const rows=r.data.map(p=>{
      const pct=Math.max(2,Math.round((p.value||0)/maxVal*100));
      const flagHtml=p.country?` <img class="sal-flag" src="https://flagcdn.com/w20/${p.country}.png" alt="" width="20" height="15">`:'';
      const valColor=r.isBestValue?'color:var(--accent)':'color:#e87461';
      return `<tr>
        <td class="rat-rank"><span class="rank-num ${p.rank<=3?'top-3':''}">${p.rank}</span></td>
        <td class="sal-player">${p.name}${flagHtml}</td>
        <td class="rat-val">${p.rating}</td>
        <td class="val-salary">${p.salary}</td>
        <td class="val-num" style="${valColor}">${p.value}</td>
        <td class="sal-bar-cell"><div class="sal-bar" style="width:${pct}%;${r.isBestValue?'':'background:linear-gradient(90deg,#e87461,#c0392b)'}"></div></td>
        <td class="rat-stat">${p.games||''}</td>
      </tr>`;
    }).join('');
    p.innerHTML=`<div class="rankings-header"><div><div class="rankings-title">${r.title}</div><div class="rankings-source">${r.source}</div></div><div class="rankings-progress">${dots}</div></div>
      <div class="sal-table-wrap"><table class="sal-table">
        <thead><tr><th class="rat-th-rank">#</th><th class="rat-th-player">PLAYER</th><th class="rat-th-rat">RAT</th><th class="val-th-sal">SALARY</th><th class="val-th-val">VAL</th><th class="sal-th-bar"></th><th class="rat-th-g">G</th></tr></thead>
        <tbody>${rows}</tbody>
      </table></div>`;
  } else if(r.isPositional){
    const rows=r.data.map(p=>{
      const pct=Math.max(2,Math.round((p.rating||0)/r.data[0].rating*100));
      const flagHtml=p.country?` <img class="sal-flag" src="https://flagcdn.com/w20/${p.country}.png" alt="" width="20" height="15">`:'';
      return `<tr>
        <td class="rat-rank"><span class="rank-num ${p.rank<=3?'top-3':''}">${p.rank}</span></td>
        <td class="sal-player">${p.name}${flagHtml}</td>
        <td class="hist-team">${p.team}</td>
        <td class="rat-val">${p.rating}</td>
        <td class="sal-bar-cell"><div class="sal-bar" style="width:${pct}%"></div></td>
        <td class="rat-stat">${p.games||''}</td>
        <td class="rat-stat">${p.pts||''}</td>
        <td class="rat-stat">${p.reb||''}</td>
        <td class="rat-stat">${p.ast||''}</td>
      </tr>`;
    }).join('');
    p.innerHTML=`<div class="rankings-header"><div><div class="rankings-title">${r.title}</div><div class="rankings-source">${r.source}</div></div><div class="rankings-progress">${dots}</div></div>
      <div class="sal-table-wrap"><table class="sal-table">
        <thead><tr><th class="rat-th-rank">#</th><th class="rat-th-player">PLAYER</th><th class="hist-th-team">TEAM</th><th class="rat-th-rat">RAT</th><th class="sal-th-bar"></th><th class="rat-th-g">G</th><th class="rat-th-stat">PTS</th><th class="rat-th-stat">REB</th><th class="rat-th-stat">AST</th></tr></thead>
        <tbody>${rows}</tbody>
      </table></div>`;
  } else if(r.isPreview){
    // Game Preview screen — 5v5 starter matchup
    function prevRow(m){
      const ap=m.away, hp=m.home;
      const aflag=ap.country?` <img class="sal-flag" src="https://flagcdn.com/w20/${ap.country}.png" width="16" height="12">`:'';
      const hflag=hp.country?` <img class="sal-flag" src="https://flagcdn.com/w20/${hp.country}.png" width="16" height="12">`:'';
      const aq=ap.questionable?' <span style="font-size:10px">❓</span>':'';
      const hq=hp.questionable?' <span style="font-size:10px">❓</span>':'';
      const aRatW=ap.rating>hp.rating?' prev-win':'';
      const hRatW=hp.rating>ap.rating?' prev-win':'';
      const aPtsW=ap.pts>hp.pts?' prev-win':'';
      const hPtsW=hp.pts>ap.pts?' prev-win':'';
      const aRebW=ap.reb>hp.reb?' prev-win':'';
      const hRebW=hp.reb>ap.reb?' prev-win':'';
      const aAstW=ap.ast>hp.ast?' prev-win':'';
      const hAstW=hp.ast>ap.ast?' prev-win':'';
      return `<tr class="prev-row">
        <td class="prev-name prev-name-l">${ap.name}${aflag}${aq}</td>
        <td class="prev-stat${aRatW}">${ap.rating||'—'}</td>
        <td class="prev-stat${aPtsW}">${ap.pts}</td>
        <td class="prev-stat${aRebW}">${ap.reb}</td>
        <td class="prev-stat${aAstW}">${ap.ast}</td>
        <td class="prev-pos">${m.pos}</td>
        <td class="prev-stat${hPtsW}">${hp.pts}</td>
        <td class="prev-stat${hRebW}">${hp.reb}</td>
        <td class="prev-stat${hAstW}">${hp.ast}</td>
        <td class="prev-stat${hRatW}">${hp.rating||'—'}</td>
        <td class="prev-name prev-name-r">${hq}${hflag} ${hp.name}</td>
      </tr>`;
    }
    let matchRows=(r.matchups||[]).map(m=>prevRow(m)).join('');

    // Team aggregates
    const at=r.awayTotals||{}, ht=r.homeTotals||{};
    const ratWA=at.rating>ht.rating?' prev-win':'';
    const ratWH=ht.rating>at.rating?' prev-win':'';
    const ptsWA=at.pts>ht.pts?' prev-win':'';
    const ptsWH=ht.pts>at.pts?' prev-win':'';
    const rebWA=at.reb>ht.reb?' prev-win':'';
    const rebWH=ht.reb>at.reb?' prev-win':'';
    const astWA=at.ast>ht.ast?' prev-win':'';
    const astWH=ht.ast>at.ast?' prev-win':'';
    const aggRow=`<tr class="prev-agg">
      <td class="prev-name prev-name-l prev-agg-label">TEAM AVG</td>
      <td class="prev-stat prev-agg-val${ratWA}">${at.rating}</td>
      <td class="prev-stat prev-agg-val${ptsWA}">${at.pts}</td>
      <td class="prev-stat prev-agg-val${rebWA}">${at.reb}</td>
      <td class="prev-stat prev-agg-val${astWA}">${at.ast}</td>
      <td class="prev-pos"></td>
      <td class="prev-stat prev-agg-val${ptsWH}">${ht.pts}</td>
      <td class="prev-stat prev-agg-val${rebWH}">${ht.reb}</td>
      <td class="prev-stat prev-agg-val${astWH}">${ht.ast}</td>
      <td class="prev-stat prev-agg-val${ratWH}">${ht.rating}</td>
      <td class="prev-name prev-name-r prev-agg-label">TEAM AVG</td>
    </tr>`;

    // Injuries row
    let injHtml='';
    const aInj=r.awayInjuries||[], hInj=r.homeInjuries||[];
    if(aInj.length||hInj.length){
      const aInjStr=aInj.map(x=>`❓ ${x.name} (${x.rating})`).join(', ')||'None reported';
      const hInjStr=hInj.map(x=>`❓ ${x.name} (${x.rating})`).join(', ')||'None reported';
      injHtml=`<tr class="prev-inj-row"><td colspan="5" class="prev-inj-cell prev-inj-l">${aInjStr}</td><td class="prev-pos" style="font-size:9px;letter-spacing:1px">INJ</td><td colspan="5" class="prev-inj-cell prev-inj-r">${hInjStr}</td></tr>`;
    }

    // Team logos
    const aLogo=r.awayTeamId?`<img class="prev-logo" src="https://cdn.nba.com/logos/nba/${r.awayTeamId}/primary/L/logo.svg" onerror="this.style.display='none'">`:'';
    const hLogo=r.homeTeamId?`<img class="prev-logo" src="https://cdn.nba.com/logos/nba/${r.homeTeamId}/primary/L/logo.svg" onerror="this.style.display='none'">`:'';

    p.innerHTML=`<div class="rankings-header"><div><div class="rankings-title">🏀 ${r.title}</div><div class="rankings-source">${r.source}</div></div><div class="rankings-progress">${dots}</div></div>
      <div class="sal-table-wrap"><table class="prev-table">
        <thead><tr>
          <th class="prev-th-name">${aLogo} ${r.awayCity}</th>
          <th class="prev-th-stat">RAT</th><th class="prev-th-stat">PTS</th><th class="prev-th-stat">REB</th><th class="prev-th-stat">AST</th>
          <th class="prev-th-pos">POS</th>
          <th class="prev-th-stat">PTS</th><th class="prev-th-stat">REB</th><th class="prev-th-stat">AST</th><th class="prev-th-stat">RAT</th>
          <th class="prev-th-name prev-th-name-r">${r.homeCity} ${hLogo}</th>
        </tr></thead>
        <tbody>${matchRows}${aggRow}${injHtml}</tbody>
      </table></div>`;
  } else if(r.isComparison){
    const a=r.playerA,b=r.playerB;
    const flagA=a.country?` <img class="sal-flag" src="https://flagcdn.com/w20/${a.country}.png" width="20" height="15">`:'';
    const flagB=b.country?`<img class="sal-flag" src="https://flagcdn.com/w20/${b.country}.png" width="20" height="15"> `:'';
    const typeIcon=r.compType==='matchup'?'🏀':'⭐';

    function fmtVal(v,fmt){
      if(fmt==='pct'){const x=v*100;return x.toFixed(1)+'%';}
      if(fmt==='spct'){const x=v*100;return (x>0?'+':'')+x.toFixed(1)+'%';}
      if(fmt==='2') return v.toFixed(2);
      if(fmt==='0') return Math.round(v).toString();
      if(fmt==='s1') return (v>=0?'+':'')+v.toFixed(1);
      return v.toFixed(1);
    }

    let sectionsHtml='';
    for(const sec of r.sections){
      let rowsHtml='';
      for(const c of sec.stats){
        const maxV=Math.max(Math.abs(c.valA),Math.abs(c.valB),0.01);
        const pctA=Math.round(Math.abs(c.valA)/maxV*100);
        const pctB=Math.round(Math.abs(c.valB)/maxV*100);
        const winA=c.winner==='A'?' comp-win':'';
        const winB=c.winner==='B'?' comp-win':'';
        rowsHtml+=`<div class="comp-row">
          <div class="comp-val comp-val-l${winA}">${fmtVal(c.valA,c.fmt)}</div>
          <div class="comp-bars">
            <div class="comp-bar-l"><div class="comp-fill-l${winA}" style="width:${pctA}%"></div></div>
            <div class="comp-lbl">${c.label}</div>
            <div class="comp-bar-r"><div class="comp-fill-r${winB}" style="width:${pctB}%"></div></div>
          </div>
          <div class="comp-val comp-val-r${winB}">${fmtVal(c.valB,c.fmt)}</div>
        </div>`;
      }
      const secScA=sec.scoreA||0, secScB=sec.scoreB||0;
      const secWinCls=secScA>secScB?' comp-sec-win-a':secScB>secScA?' comp-sec-win-b':'';
      sectionsHtml+=`<div class="comp-sec"><div class="comp-sec-hd${secWinCls}"><span class="comp-sec-score">${secScA}</span> ${sec.label} <span class="comp-sec-score">${secScB}</span></div>${rowsHtml}</div>`;
    }

    // Overall score
    const scA=r.scoreA||0, scB=r.scoreB||0;
    const overallWinA=scA>scB, overallWinB=scB>scA;

    const footer=`<div class="comp-footer">
      <div class="comp-foot-col"><div class="comp-foot-val">${a.gp!==undefined?a.gp:'—'}</div><div class="comp-foot-val">${a.salary||'—'}</div></div>
      <div class="comp-foot-col comp-foot-mid"><div class="comp-foot-lbl">GP</div><div class="comp-foot-lbl">SALARY</div></div>
      <div class="comp-foot-col comp-foot-right"><div class="comp-foot-val">${b.gp!==undefined?b.gp:'—'}</div><div class="comp-foot-val">${b.salary||'—'}</div></div>
    </div>`;

    p.innerHTML=`<div class="rankings-header"><div><div class="rankings-title">${typeIcon} ${r.title}</div><div class="rankings-source">${r.source}</div></div><div class="rankings-progress">${dots}</div></div>
      <div class="comp-card">
        <div class="comp-header">
          <div class="comp-player comp-player-l">
            <div class="comp-name">${a.name}${flagA}</div>
            <div class="comp-team">${a.team}</div>
          </div>
          <div class="comp-score-col">
            <div class="comp-overall"><span class="comp-overall-num${overallWinA?' comp-win':''}">${scA}</span><span class="comp-overall-vs">–</span><span class="comp-overall-num${overallWinB?' comp-win':''}">${scB}</span></div>
            <div class="comp-vs-badge">VS</div>
          </div>
          <div class="comp-player comp-player-r">
            <div class="comp-name">${flagB}${b.name}</div>
            <div class="comp-team">${b.team}</div>
          </div>
        </div>
        <div class="comp-body">${sectionsHtml}</div>
        ${footer}
      </div>`;
  } else if(r.isTransaction){
    const rows=r.data.map(t=>{
      const flagHtml=t.country?` <img class="sal-flag" src="https://flagcdn.com/w20/${t.country}.png" alt="" width="20" height="15">`:'';
      return `<tr>
        <td class="tx-date">${t.date}</td>
        <td class="tx-team">${t.team}</td>
        <td class="tx-player">${t.player}${flagHtml}</td>
        <td class="tx-notes">${t.notes}</td>
        <td class="tx-salary">${t.salary}</td>
      </tr>`;
    }).join('');
    p.innerHTML=`<div class="rankings-header"><div><div class="rankings-title">${r.title}</div><div class="rankings-source">${r.source}</div></div><div class="rankings-progress">${dots}</div></div>
      <div class="sal-table-wrap"><table class="tx-table">
        <thead><tr><th class="tx-date">DATE</th><th class="tx-team">TEAM</th><th>PLAYER</th><th>NOTES</th><th style="text-align:right">SALARY</th></tr></thead>
        <tbody>${rows}</tbody>
      </table></div>`;
  } else if(r.isHistSalary){
    const maxSal=r.maxSalary||1;
    const rows=r.data.map(p=>{
      const pct=Math.max(2,Math.round(p.salary/maxSal*100));
      const flagHtml=p.country?` <img class="sal-flag" src="https://flagcdn.com/w20/${p.country}.png" alt="" width="20" height="15">`:'';
      return `<tr>
        <td class="rat-rank"><span class="rank-num ${p.rank<=3?'top-3':''}">${p.rank}</span></td>
        <td class="sal-player">${p.name}${flagHtml}</td>
        <td class="hist-team">${p.team}</td>
        <td class="sal-salary">${p.salaryDisplay}</td>
        <td class="sal-bar-cell"><div class="sal-bar" style="width:${pct}%"></div></td>
      </tr>`;
    }).join('');
    p.innerHTML=`<div class="rankings-header"><div><div class="rankings-title">${r.title}</div><div class="rankings-source">${r.source}</div></div><div class="rankings-progress">${dots}</div></div>
      <div class="sal-table-wrap"><table class="sal-table">
        <thead><tr><th class="rat-th-rank">#</th><th class="rat-th-player">PLAYER</th><th class="hist-th-team">TEAM</th><th class="sal-th-salary">SALARY</th><th class="sal-th-bar"></th></tr></thead>
        <tbody>${rows}</tbody>
      </table></div>`;
  } else if(r.isTeam){
    const maxSal=r.maxSalary||1;
    const rows=r.data.map(row=>{
      const pct=Math.max(2,Math.round(row.salRaw/maxSal*100));
      const flagHtml=row.country?` <img class="sal-flag" src="https://flagcdn.com/w20/${row.country}.png" alt="" width="20" height="15">`:'';
      return `<tr>
        <td class="sal-player">${row.name}${flagHtml}</td>
        <td class="sal-salary-stack"><div class="sal-current">${row.sal}</div><div class="sal-next-yr">${row.salNext}</div></td>
        <td class="sal-bar-cell"><div class="sal-bar" style="width:${pct}%"></div></td>
        <td class="sal-status">${row.status}</td>
      </tr>`;
    }).join('');
    p.innerHTML=`<div class="rankings-header"><div><div class="rankings-title">${r.title}</div><div class="rankings-source">${r.source}</div></div><div class="rankings-progress">${dots}</div></div>
      <div class="sal-table-wrap"><table class="sal-table">
        <thead><tr><th class="sal-th-player">PLAYER</th><th class="sal-th-salary">25-26 / 26-27</th><th class="sal-th-bar"></th><th class="sal-th-status">STATUS</th></tr></thead>
        <tbody>${rows}</tbody>
      </table></div>`;
  } else if(r.isRating){
    const maxRat=Math.max(...r.data.map(p=>parseFloat(p.rating)||0),1);
    let thead,rows;
    if(r.isForm){
      thead=`<tr><th class="rat-th-rank">#</th><th class="rat-th-player">PLAYER</th><th class="hist-th-team">TEAM</th><th class="rat-th-rat">RATING</th><th class="rat-th-bar"></th><th class="rat-th-stat">2024-25</th><th class="rat-th-stat">DIFF</th></tr>`;
      rows=r.data.map(p=>{
        const pct=Math.max(2,Math.round((parseFloat(p.rating)||0)/maxRat*100));
        const flagHtml=p.country?` <img class="sal-flag" src="https://flagcdn.com/w20/${p.country}.png" alt="" width="20" height="15">`:'';
        const diffVal=parseFloat(p.diff)||0;
        const diffCls=diffVal>0?'rat-diff-up':diffVal<0?'rat-diff-down':'';
        const diffPrefix=diffVal>0?'+':'';
        return `<tr>
          <td class="rat-rank"><span class="rank-num ${p.rank<=3?'top-3':''}">${p.rank}</span></td>
          <td class="sal-player">${p.name}${flagHtml}</td>
          <td class="hist-team">${p.team||''}</td>
          <td class="rat-val">${p.rating}</td>
          <td class="sal-bar-cell"><div class="sal-bar" style="width:${pct}%"></div></td>
          <td class="rat-stat">${p.oldRating}</td>
          <td class="rat-stat ${diffCls}">${diffPrefix}${p.diff}</td>
        </tr>`;
      }).join('');
    } else if(r.isLumped){
      thead=`<tr><th class="rat-th-rank">#</th><th class="rat-th-player">PLAYER</th><th class="hist-th-team">TEAM</th><th class="rat-th-g">DRAFT</th><th class="rat-th-rat">RAT</th><th class="rat-th-bar"></th><th class="rat-th-g">G</th><th class="rat-th-stat">PTS</th><th class="rat-th-stat">REB</th><th class="rat-th-stat">AST</th></tr>`;
      rows=r.data.map(p=>{
        const pct=Math.max(2,Math.round((parseFloat(p.rating)||0)/maxRat*100));
        const flagHtml=p.country?` <img class="sal-flag" src="https://flagcdn.com/w20/${p.country}.png" alt="" width="20" height="15">`:'';
        return `<tr>
          <td class="rat-rank"><span class="rank-num ${p.rank<=3?'top-3':''}">${p.rank}</span></td>
          <td class="sal-player">${p.name}${flagHtml}</td>
          <td class="hist-team">${p.team||''}</td>
          <td class="rat-stat">${p.draftYear||''}</td>
          <td class="rat-val">${p.rating}</td>
          <td class="sal-bar-cell"><div class="sal-bar" style="width:${pct}%"></div></td>
          <td class="rat-stat">${p.games||''}</td>
          <td class="rat-stat">${p.pts}</td>
          <td class="rat-stat">${p.reb}</td>
          <td class="rat-stat">${p.ast}</td>
        </tr>`;
      }).join('');
    } else {
      thead=`<tr><th class="rat-th-rank">#</th><th class="rat-th-player">PLAYER</th><th class="hist-th-team">TEAM</th><th class="rat-th-rat">RAT</th><th class="rat-th-bar"></th><th class="rat-th-g">G</th><th class="rat-th-stat">PTS</th><th class="rat-th-stat">REB</th><th class="rat-th-stat">AST</th></tr>`;
      rows=r.data.map(p=>{
        const pct=Math.max(2,Math.round((parseFloat(p.rating)||0)/maxRat*100));
        const flagHtml=p.country?` <img class="sal-flag" src="https://flagcdn.com/w20/${p.country}.png" alt="" width="20" height="15">`:'';
        return `<tr>
          <td class="rat-rank"><span class="rank-num ${p.rank<=3?'top-3':''}">${p.rank}</span></td>
          <td class="sal-player">${p.name}${flagHtml}</td>
          <td class="hist-team">${p.team||''}</td>
          <td class="rat-val">${p.rating}</td>
          <td class="sal-bar-cell"><div class="sal-bar" style="width:${pct}%"></div></td>
          <td class="rat-stat">${p.games||''}</td>
          <td class="rat-stat">${p.pts}</td>
          <td class="rat-stat">${p.reb}</td>
          <td class="rat-stat">${p.ast}</td>
        </tr>`;
      }).join('');
    }
    p.innerHTML=`<div class="rankings-header"><div><div class="rankings-title">${r.title}</div><div class="rankings-source">${r.source}</div></div><div class="rankings-progress">${dots}</div></div>
      <div class="sal-table-wrap"><table class="sal-table">
        <thead>${thead}</thead>
        <tbody>${rows}</tbody>
      </table></div>`;
  } else if(r.isInjury){
    function injCol(items){
      if(!items||items.length===0)return '';
      const rows=items.map(p=>{
        if(p.isHeader) return `<tr class="inj-team-header"><td colspan="4">${p.team}</td></tr>`;
        const flagHtml=p.country?` <img class="sal-flag" src="https://flagcdn.com/w20/${p.country}.png" alt="" width="20" height="15">`:'';
        const st=p.status||'';
        const stLower=st.toLowerCase();
        const stCls=stLower==='out'?'inj-out':stLower==='doubtful'?'inj-doubtful':stLower==='questionable'?'inj-quest':stLower==='probable'?'inj-prob':stLower==='available'?'inj-avail':'';
        return `<tr>
          <td class="sal-player">${p.name}${flagHtml}</td>
          <td class="inj-status ${stCls}">${st}</td>
          <td class="inj-detail">${p.injury||''}</td>
          <td class="inj-date">${p.date||''}</td>
        </tr>`;
      }).join('');
      return `<table class="inj-table"><thead><tr><th class="inj-th-player">PLAYER</th><th class="inj-th-status">STATUS</th><th class="inj-th-detail">INJURY</th><th class="inj-th-date">DATE</th></tr></thead><tbody>${rows}</tbody></table>`;
    }
    const leftHtml=injCol(r.left);
    const rightHtml=injCol(r.right);
    p.innerHTML=`<div class="rankings-header"><div><div class="rankings-title">${r.title}</div><div class="rankings-source">${r.source}</div></div><div class="rankings-progress">${dots}</div></div>
      <div class="inj-two-col">${leftHtml}${rightHtml}</div>`;
  } else if(r.isDepth){
    const posLabels=['PG','SG','SF','PF','C'];
    let allRows='';
    for(const team of r.data){
      // Team header row
      allRows+=`<tr class="dep-team-header"><td colspan="6">${team.name}</td></tr>`;
      for(const level of team.levels){
        const rowCls=level.label==='Starters'?'dep-row-starters':level.label==='Bench'?'dep-row-bench':'dep-row-out';
        const cells=posLabels.map(pos=>{
          const p=level.players.find(x=>x.pos===pos);
          if(!p)return `<td class="dep-cell dep-empty">—</td>`;
          const flagHtml=p.country?` <img class="sal-flag" src="https://flagcdn.com/w20/${p.country}.png" alt="" width="20" height="15">`:'';
          const qHtml=p.questionable?' <span title="Questionable">❓</span>':'';
          return `<td class="dep-cell">
            <div class="dep-name">${p.name}${flagHtml}${qHtml}</div>
            <div class="dep-sal">${p.salary||''}</div>
          </td>`;
        }).join('');
        allRows+=`<tr class="${rowCls}"><td class="dep-level">${level.label}</td>${cells}</tr>`;
      }
    }
    p.innerHTML=`<div class="rankings-header"><div><div class="rankings-title">${r.title}</div><div class="rankings-source">${r.source}</div></div><div class="rankings-progress">${dots}</div></div>
      <div class="sal-table-wrap"><table class="dep-table">
        <thead><tr><th class="dep-th-level"></th>${posLabels.map(p=>`<th class="dep-th-pos">${p}</th>`).join('')}</tr></thead>
        <tbody>${allRows}</tbody>
      </table><div class="dep-key">❓ Questionable</div></div>`;
  } else {
    const headerRow=r.columns.map(c=>`<th>${c}</th>`).join('');
    const bodyRows=r.data.map(row=>{
      const cells=row.map((val,ci)=>{
        if(ci===0)return `<td><span class="rank-num ${val<=3?'top-3':''}">${val}</span></td>`;
        if(ci===1)return `<td><span class="rank-player">${val}</span></td>`;
        return `<td><span class="rank-value">${val}</span></td>`;
      }).join('');
      return `<tr>${cells}</tr>`;
    }).join('');
    p.innerHTML=`<div class="rankings-header"><div><div class="rankings-title">${r.title}</div><div class="rankings-source">${r.source}</div></div><div class="rankings-progress">${dots}</div></div>
      <table class="rankings-table"><thead><tr>${headerRow}</tr></thead><tbody>${bodyRows}</tbody></table>`;
  }
  // Add "NEXT" preview at bottom
  const nextIdx=(currentRankingIndex+1)%rankingsScreens.length;
  if(rankingsScreens.length>1){
    const nextScreen=rankingsScreens[nextIdx];
    const nextTitle=nextScreen.title||'';
    const nextDiv=document.createElement('div');
    nextDiv.className='rankings-next';
    nextDiv.innerHTML=`<span class="rankings-next-label">NEXT ▸</span> <span class="rankings-next-title">${nextTitle}</span>`;
    p.appendChild(nextDiv);
  }
}let currentNextGamesPage=0;
function renderNextGames(games){
  const perPage=5;
  nextGamesPages=[];
  for(let i=0;i<games.length;i+=perPage){nextGamesPages.push(games.slice(i,i+perPage));}
  if(nextGamesPages.length===0)nextGamesPages=[[]];
  currentNextGamesPage=0;
  _showNextGamesPage();
}
function _showNextGamesPage(){
  const container=document.getElementById('nextGamesList');
  const page=nextGamesPages[currentNextGamesPage]||[];
  container.innerHTML=nextGamesPages.map((pg,pi)=>`<div class="next-games-page${pi===currentNextGamesPage?' active':''}">${pg.map(g=>`<div class="next-game-item"><span class="next-game-teams">${g.away} @ ${g.home}</span><span class="next-game-time">${g.time}</span></div>`).join('')}</div>`).join('');
}
function rotateNextGames(){if(nextGamesPages.length<=1)return;currentNextGamesPage=(currentNextGamesPage+1)%nextGamesPages.length;_showNextGamesPage();}
function rotateRankings(){if(rankingsScreens.length===0)return;currentRankingIndex=(currentRankingIndex+1)%rankingsScreens.length;renderRankings(rankingsScreens[currentRankingIndex]);updateNavHighlight();}

let currentMode=null;
function setMode(mode){if(mode===currentMode)return;currentMode=mode;const fg=document.getElementById('featuredGame'),ms=document.getElementById('miniScores'),rm=document.getElementById('rankingsMode'),lb=document.getElementById('liveBadge');if(mode==='live'){fg.classList.remove('hidden');ms.classList.remove('hidden');rm.classList.remove('active');lb.style.display='flex';}else{fg.classList.add('hidden');ms.classList.add('hidden');rm.classList.add('active');lb.style.display='none';const scheduled=getGames().filter(g=>g.status==='scheduled');if(scheduled.length>0){renderNextGames(scheduled.map(g=>({away:g.away.abbr,home:g.home.abbr,time:g.clock||'TBD'})));}else{renderNextGames(MOCK_NEXT_GAMES);}if(rankingsScreens.length>0){renderRankings(rankingsScreens[currentRankingIndex]);}}}
// LIVE mode: from first tip-off until 6h after last game ends
// Fallback: if all games scheduled, stay in rankings until first goes live
// If all games final, stay live for 6 hours after (estimated via scheduled start + 8.5h)
let lastFinalSeenAt=null; // timestamp when we first saw all games final
function determineAutoMode(games){
  if(!games||games.length===0)return'rankings';
  // Any game currently live → LIVE mode
  if(games.some(g=>g.status==='live')){lastFinalSeenAt=null;return'live';}
  // Any final games exist
  const finals=games.filter(g=>g.status==='final');
  if(finals.length>0){
    // Track when all games became final
    const allDone=games.every(g=>g.status==='final'||g.status==='scheduled');
    const anyPlayed=finals.length>0;
    if(anyPlayed){
      if(!lastFinalSeenAt)lastFinalSeenAt=Date.now();
      const hoursSinceFinal=(Date.now()-lastFinalSeenAt)/3600000;
      // Stay LIVE for 6 hours after last game ended
      if(hoursSinceFinal<6)return'live';
      return'rankings';
    }
  }
  // All scheduled, no live/final → rankings (waiting for tip-off)
  return'rankings';
}

function simulateScoreUpdate(){if(liveGames)return;MOCK_GAMES.forEach(g=>{if(g.status==='live'){if(Math.random()>0.5){const side=Math.random()>0.5?'home':'away';g[side].score+=Math.random()>0.7?3:2;}let[m,s]=g.clock.split(':').map(Number);s-=Math.floor(Math.random()*20)+5;if(s<0){m--;s+=60;}if(m<0)m=11;g.clock=`${m}:${s.toString().padStart(2,'0')}`;}});if(currentMode==='live'){const current=lastShownGameId?MOCK_GAMES.find(g=>g.id===lastShownGameId):null;if(current){renderGameScreens(current);renderMiniScores(MOCK_GAMES,current.id);}}}

// ═══ LIVE API POLLING ═══
let liveFeed=null;    // null = not yet loaded from API
let liveHeadlines=null;
let liveGames=null;   // null = not yet loaded; use MOCK_GAMES as fallback

function pollBluesky(){
  console.log('[API] Polling /api/bluesky...');
  fetch('/api/bluesky').then(r=>{
    if(!r.ok) throw new Error('HTTP '+r.status);
    return r.json();
  }).then(data=>{
    console.log('[API] Bluesky response:',data.count,'posts, first:',data.posts[0]?.author||'(none)');
    if(data.posts&&data.posts.length>0){
      liveFeed=data.posts;
      renderFeed(liveFeed);
      console.log('[API] Bluesky feed rendered with',liveFeed.length,'real posts');
    }else{
      console.log('[API] Bluesky returned empty — keeping current feed');
    }
  }).catch(e=>console.warn('[API] Bluesky poll failed:',e));
}

function pollHeadlines(){
  console.log('[API] Polling /api/headlines...');
  fetch('/api/headlines').then(r=>{
    if(!r.ok) throw new Error('HTTP '+r.status);
    return r.json();
  }).then(data=>{
    console.log('[API] Headlines response:',data.count,'items, first:',data.headlines[0]?.text?.slice(0,50)||'(none)');
    if(data.headlines&&data.headlines.length>0){
      liveHeadlines=data.headlines;
      renderTicker(liveHeadlines);
      console.log('[API] Ticker rendered with',liveHeadlines.length,'real headlines');
    }else{
      console.log('[API] Headlines returned empty — keeping current ticker');
    }
  }).catch(e=>console.warn('[API] Headlines poll failed:',e));
}

function pollScores(){
  console.log('[API] Polling /api/scores...');
  fetch('/api/scores').then(r=>{
    if(!r.ok) throw new Error('HTTP '+r.status);
    return r.json();
  }).then(data=>{
    console.log('[API] Scores response:',data.count,'games, hasLive:',data.hasLive);
    if(data.games&&data.games.length>0){
      liveGames=data.games;
      // Re-render current game (find by lastShownGameId)
      const allGames=getGames();
      const current=lastShownGameId?allGames.find(g=>g.id===lastShownGameId):null;
      const playable=allGames.filter(g=>g.status!=='scheduled');
      const display=current||playable[0]||allGames[0];
      if(display){
        lastShownGameId=display.id;
        renderGameScreens(display);
        renderMiniScores(allGames,display.id);
      }
      // Update mode: live if any active/final games, rankings if all scheduled or no games
      const mode=determineAutoMode(allGames);
      setMode(mode);
      console.log('[API] Scores rendered:',data.count,'games, mode:',mode);
    }else{
      console.log('[API] No games today — switching to rankings mode');
      liveGames=[];
      setMode('rankings');
    }
  }).catch(e=>console.warn('[API] Scores poll failed:',e));
}

function init(){
  lastShownGameId=MOCK_GAMES[0].id;
  renderGameScreens(MOCK_GAMES[0]);renderMiniScores(MOCK_GAMES,MOCK_GAMES[0].id);
  // Show mock data immediately as fallback
  renderTicker(MOCK_HEADLINES);renderFeed(MOCK_FEED);
  setMode(determineAutoMode(MOCK_GAMES));
  // Hash-based section navigation: http://localhost:5000/#depth etc.
  const hashMap={'#team-ratings':'teamRatings','#stats':'countingStats','#depth':'depth','#injuries':'injuries','#ratings':'ratings','#draft':'draftClass','#transactions':'transactions','#value':'value','#matchups':'matchups','#salaries':'salaries','#history':'histSalaries'};
  function checkHash(){
    const h=window.location.hash.toLowerCase();
    if(hashMap[h]){
      setTimeout(()=>{setMode('rankings');setTimeout(()=>jumpSection(hashMap[h]),500);},1000);
    }
  }
  checkHash();
  window.addEventListener('hashchange',()=>{const h=window.location.hash.toLowerCase();if(hashMap[h]){setMode('rankings');setTimeout(()=>jumpSection(hashMap[h]),200);}});
  scheduleNextScreen(); // kick off per-screen timer (screen 0 → 9s, screen 1/2 → 15s, then rotateGame)
  setInterval(rotateRankings,CONFIG.rankingsRotateInterval);
  setInterval(rotateNextGames,8000);
  setInterval(simulateScoreUpdate,5000);
  setInterval(()=>setMode(determineAutoMode(getGames())),30000);
function jumpSection(section){
  const idx=sectionStarts[section];
  if(idx!==undefined){
    if(currentMode!=='rankings')setMode('rankings');
    currentRankingIndex=idx;
    renderRankings(rankingsScreens[idx]);
    updateNavHighlight();
  }
}
function updateNavHighlight(){
  const btns=document.querySelectorAll('.section-btn');
  const sections=['teamRatings','countingStats','depth','injuries','ratings','draftClass','transactions','value','matchups','salaries','histSalaries'];
  let current='';
  for(let i=sections.length-1;i>=0;i--){
    if(sectionStarts[sections[i]]!==undefined&&currentRankingIndex>=sectionStarts[sections[i]]){current=sections[i];break;}
  }
  btns.forEach(b=>{b.classList.toggle('active',b.dataset.section===current);});
}
  document.addEventListener('keydown',e=>{
    if(e.key==='1')setMode('live');
    if(e.key==='2')setMode('rankings');
    // Section jumps (in rankings mode)
    if(currentMode==='rankings'&&rankingsScreens.length>0){
      const jumpTo=(idx)=>{if(idx!==undefined){currentRankingIndex=idx;renderRankings(rankingsScreens[idx]);updateNavHighlight();}};
      if(e.key==='t'||e.key==='T')jumpTo(sectionStarts.teamRatings);
      if(e.key==='c'||e.key==='C')jumpTo(sectionStarts.countingStats);
      if(e.key==='d'||e.key==='D')jumpTo(sectionStarts.depth);
      if(e.key==='i'||e.key==='I')jumpTo(sectionStarts.injuries);
      if(e.key==='g'||e.key==='G')jumpTo(sectionStarts.ratings);
      if(e.key==='y'||e.key==='Y')jumpTo(sectionStarts.draftClass);
      if(e.key==='x'||e.key==='X')jumpTo(sectionStarts.transactions);
      if(e.key==='v'||e.key==='V')jumpTo(sectionStarts.value);
      if(e.key==='m'||e.key==='M')jumpTo(sectionStarts.matchups);
      if(e.key==='p'||e.key==='P')jumpTo(sectionStarts.previews);
      if(e.key==='s'||e.key==='S')jumpTo(sectionStarts.salaries);
      if(e.key==='h'||e.key==='H')jumpTo(sectionStarts.histSalaries);
      if(e.key==='ArrowRight'){currentRankingIndex=(currentRankingIndex+1)%rankingsScreens.length;renderRankings(rankingsScreens[currentRankingIndex]);updateNavHighlight();}
      if(e.key==='ArrowLeft'){currentRankingIndex=(currentRankingIndex-1+rankingsScreens.length)%rankingsScreens.length;renderRankings(rankingsScreens[currentRankingIndex]);updateNavHighlight();}
    }
  });
  // Start live API polling — fetch immediately, then on interval
  pollBluesky();pollHeadlines();pollScores();
  setInterval(pollBluesky,120000);   // every 2 minutes
  setInterval(pollHeadlines,180000); // every 3 minutes
  setInterval(pollScores,30000);     // every 30 seconds
}
init();
</script>
</body>
</html>
